<html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:w="urn:schemas-microsoft-com:office:word" xmlns="http://www.w3.org/TR/REC-html40"><head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<meta name="ProgId" content="Word.Document">
<meta name="Generator" content="Microsoft Word 9">
<meta name="Originator" content="Microsoft Word 9">
<link rel="File-List" href="http://www.eclipse.org/articles/Article-Writing%20Your%20Own%20Widget/Writing%20Your%20Own%20Widget_files/filelist.xml">
<link rel="Edit-Time-Data" href="http://www.eclipse.org/articles/Article-Writing%20Your%20Own%20Widget/Writing%20Your%20Own%20Widget_files/editdata.mso">
<link rel="OLE-Object-Data" href="http://www.eclipse.org/articles/Article-Writing%20Your%20Own%20Widget/Writing%20Your%20Own%20Widget_files/oledata.mso"><!--[if !mso]>
<style>
v\:* {behavior:url(#default#VML);}
o\:* {behavior:url(#default#VML);}
w\:* {behavior:url(#default#VML);}
.shape {behavior:url(#default#VML);}
</style>
<![endif]--><title>Writing Your Own Widget</title><!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>OTI EMPLOYEE</o:Author>
  <o:LastAuthor>Dave Thomson</o:LastAuthor>
  <o:Revision>12</o:Revision>
  <o:TotalTime>2064</o:TotalTime>
  <o:LastPrinted>2001-02-09T19:31:00Z</o:LastPrinted>
  <o:Created>2001-06-04T02:12:00Z</o:Created>
  <o:LastSaved>2001-06-04T18:05:00Z</o:LastSaved>
  <o:Pages>30</o:Pages>
  <o:Words>8616</o:Words>
  <o:Characters>49116</o:Characters>
  <o:Company>OBJECT TECHNOLOGY INTL</o:Company>
  <o:Lines>409</o:Lines>
  <o:Paragraphs>98</o:Paragraphs>
  <o:CharactersWithSpaces>60317</o:CharactersWithSpaces>
  <o:Version>9.2720</o:Version>
 </o:DocumentProperties>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:HideSpellingErrors/>
  <w:DoNotHyphenateCaps/>
  <w:DisplayHorizontalDrawingGridEvery>0</w:DisplayHorizontalDrawingGridEvery>
  <w:DisplayVerticalDrawingGridEvery>0</w:DisplayVerticalDrawingGridEvery>
  <w:UseMarginsForDrawingGridOrigin/>
  <w:Compatibility>
   <w:UsePrinterMetrics/>
   <w:WW6BorderRules/>
   <w:FootnoteLayoutLikeWW8/>
   <w:ShapeLayoutLikeWW8/>
   <w:AlignTablesRowByRow/>
   <w:ForgetLastTabAlignment/>
   <w:LayoutRawTableWidth/>
   <w:LayoutTableRowsApart/>
  </w:Compatibility>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
 </w:WordDocument>
</xml><![endif]-->



<link rel="Stylesheet" type="text/css" media="all" href="Writing%20Your%20Own%20Widget_files/default_style.css">
<style>
<!--
 /* Style Definitions */
p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	color:windowtext;}
h1
	{mso-style-next:Normal;
	margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:0in;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:1;
	font-size:21.0pt;
	font-family:Arial;
	color:windowtext;
	mso-font-kerning:14.0pt;
	font-weight:bold;}
h2
	{mso-style-next:Normal;
	margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:6.0pt;
	margin-left:0in;
	mso-line-height-alt:10.5pt;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:2;
	font-size:18.0pt;
	font-family:Arial;
	color:windowtext;
	font-weight:bold;}
h3
	{mso-style-next:Normal;
	margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:0in;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:3;
	font-size:14.0pt;
	font-family:Arial;
	color:windowtext;
	font-weight:bold;}
h4
	{mso-style-next:Normal;
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:4;
	tab-stops:24.0pt 48.0pt 1.0in 96.0pt 120.0pt 2.0in 168.0pt 192.0pt 3.0in 240.0pt 264.0pt 4.0in 312.0pt 336.0pt 5.0in 384.0pt 408.0pt 6.0in 456.0pt 480.0pt 7.0in 528.0pt 552.0pt 8.0in 600.0pt 624.0pt 9.0in 672.0pt 696.0pt 10.0in 744.0pt 768.0pt;
	layout-grid-mode:char;
	font-size:18.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	color:windowtext;
	font-weight:normal;}
p.MsoToc1, li.MsoToc1, div.MsoToc1
	{mso-style-next:Normal;
	margin-top:.25in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	tab-stops:right 6.0in;
	font-size:12.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	color:windowtext;
	text-transform:uppercase;
	font-weight:bold;
	mso-bidi-font-weight:normal;}
p.MsoToc2, li.MsoToc2, div.MsoToc2
	{mso-style-next:Normal;
	margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	tab-stops:right 6.0in;
	font-size:12.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	color:windowtext;
	font-weight:bold;
	mso-bidi-font-weight:normal;}
p.MsoToc3, li.MsoToc3, div.MsoToc3
	{mso-style-next:Normal;
	margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:10.0pt;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	tab-stops:right 6.0in;
	font-size:12.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	color:windowtext;}
p.MsoToc4, li.MsoToc4, div.MsoToc4
	{mso-style-next:Normal;
	margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:20.0pt;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	tab-stops:right 6.0in;
	font-size:12.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	color:windowtext;}
p.MsoToc5, li.MsoToc5, div.MsoToc5
	{mso-style-next:Normal;
	margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:30.0pt;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	tab-stops:right 6.0in;
	font-size:12.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	color:windowtext;}
p.MsoToc6, li.MsoToc6, div.MsoToc6
	{mso-style-next:Normal;
	margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:40.0pt;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	tab-stops:right 6.0in;
	font-size:12.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	color:windowtext;}
p.MsoToc7, li.MsoToc7, div.MsoToc7
	{mso-style-next:Normal;
	margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:50.0pt;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	tab-stops:right 6.0in;
	font-size:12.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	color:windowtext;}
p.MsoToc8, li.MsoToc8, div.MsoToc8
	{mso-style-next:Normal;
	margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:60.0pt;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	tab-stops:right 6.0in;
	font-size:12.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	color:windowtext;}
p.MsoToc9, li.MsoToc9, div.MsoToc9
	{mso-style-next:Normal;
	margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:70.0pt;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	tab-stops:right 6.0in;
	font-size:12.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	color:windowtext;}
p.MsoHeader, li.MsoHeader, div.MsoHeader
	{margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	tab-stops:center 3.0in right 6.0in;
	font-size:12.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	color:windowtext;}
p.MsoFooter, li.MsoFooter, div.MsoFooter
	{margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	tab-stops:center 3.0in right 6.0in;
	font-size:12.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	color:windowtext;}
p.MsoBodyText, li.MsoBodyText, div.MsoBodyText
	{margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	color:red;}
p.MsoBodyText2, li.MsoBodyText2, div.MsoBodyText2
	{margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	tab-stops:.25in .5in .75in 1.0in 1.25in 1.5in;
	layout-grid-mode:char;
	font-size:9.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Courier New";
	mso-fareast-font-family:"Times New Roman";
	mso-bidi-font-family:"Times New Roman";
	color:black;}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;
	text-underline:single;}
a:visited, span.MsoHyperlinkFollowed
	{color:purple;
	text-decoration:underline;
	text-underline:single;}
strong
	{mso-bidi-font-weight:normal;}
em
	{mso-bidi-font-style:normal;}
p
	{margin-top:5.0pt;
	margin-right:0in;
	margin-bottom:5.0pt;
	margin-left:0in;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:Arial;
	mso-fareast-font-family:"Times New Roman";
	color:black;}
code
	{mso-ansi-font-size:8.5pt;
	mso-bidi-font-size:8.5pt;
	mso-ascii-font-family:"Courier New";
	mso-fareast-font-family:"Times New Roman";
	mso-hansi-font-family:"Courier New";
	mso-bidi-font-family:"Courier New";}
pre
	{margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
	font-size:10.0pt;
	font-family:"Courier New";
	mso-fareast-font-family:"Courier New";
	color:windowtext;}
p.Code, li.Code, div.Code
	{mso-style-name:Code;
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	tab-stops:.25in .5in .75in 1.0in 1.25in 1.5in 1.75in 2.0in 2.25in 2.5in 2.75in 3.0in 3.25in 3.5in 3.75in 4.0in 4.25in 4.5in 4.75in 5.0in 5.25in 5.5in 5.75in;
	layout-grid-mode:char;
	font-size:9.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Courier New";
	mso-fareast-font-family:"Times New Roman";
	mso-bidi-font-family:"Times New Roman";
	color:windowtext;}
@page Section1
	{size:8.5in 11.0in;
	margin:1.0in 1.25in 1.0in 1.25in;
	mso-header-margin:.5in;
	mso-footer-margin:.5in;
	mso-title-page:yes;
	mso-even-footer:url("./Writing%20Your%20Own%20Widget_files/header.htm") ef1;
	mso-footer:url("./Writing%20Your%20Own%20Widget_files/header.htm") f1;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
 /* List Definitions */
@list l0
	{mso-list-id:-2;
	mso-list-type:simple;
	mso-list-template-ids:-1;}
@list l0:level1
	{mso-level-start-at:0;
	mso-level-text:*;
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:0in;
	text-indent:0in;}
@list l1
	{mso-list-id:174617761;
	mso-list-type:simple;
	mso-list-template-ids:67698689;}
@list l1:level1
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:.25in;
	mso-level-number-position:left;
	margin-left:.25in;
	text-indent:-.25in;
	font-family:Symbol;}
@list l2
	{mso-list-id:1592273852;
	mso-list-type:simple;
	mso-list-template-ids:67698689;}
@list l2:level1
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:.25in;
	mso-level-number-position:left;
	margin-left:.25in;
	text-indent:-.25in;
	font-family:Symbol;}
@list l0:level1 lfo2
	{mso-level-number-format:bullet;
	mso-level-numbering:continue;
	mso-level-text:\F0B7;
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	mso-level-legacy:yes;
	mso-level-legacy-indent:.25in;
	mso-level-legacy-space:0in;
	margin-left:.25in;
	text-indent:-.25in;
	font-family:Symbol;}
ol
	{margin-bottom:0in;}
ul
	{margin-bottom:0in;}
-->
</style><!--[if gte mso 9]><xml>
 <o:shapedefaults v:ext="edit" spidmax="1050"/>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <o:shapelayout v:ext="edit">
  <o:idmap v:ext="edit" data="1"/>
 </o:shapelayout></xml><![endif]--></head>

<body style="" lang="EN-US" link="blue" vlink="purple">

<div class="Section1">

<p class="MsoNormal" style="margin: 14.2pt 0in 0.0001pt 25.5pt; text-align: right;" align="right"><a name="_Toc496069418"></a><a name="_Toc506634621"><span style=""><span style="font-size: 8pt;">Copyright
© 2001 Object Technology International, Inc.<o:p></o:p></span></span></a></p>

<span style=""><span style=""></span></span>
 <table style="width: 100%; margin-left: 25.5pt;" border="0" cellpadding="0" cellspacing="0" width="100%">
 <tbody><tr>
  <td style="padding: 1.5pt; background: rgb(0, 128, 192) none repeat scroll 0%; -moz-background-clip: initial; -moz-background-origin: initial; -moz-background-inline-policy: initial;" valign="top">
  <p class="MsoNormal"><span style=""><span style=""><b><span style="font-family: Arial; color: white;">&nbsp;Eclipse Corner Article</span></b></span></span><span style=""><span style=""><span style=""><o:p></o:p></span></span></span></p>
  </td>
  </tr>
</tbody></table>

<h1 style="margin-left: 25.5pt;"><span style=""><span style=""><img id="_x0000_i1043" src="Writing%20Your%20Own%20Widget_files/Idea.jpg" align="middle" height="86" width="120"></span></span><span style=""><span style=""><span style="font-size: 8pt;"><o:p></o:p></span></span></span></h1>

<h1 style="margin-left: 25.5pt; text-align: center;" align="center"><span style=""><span style="">Creating
Your Own Widgets using SWT</span></span></h1>

<p class="MsoNormal" style="margin-left: 25.5pt; text-indent: 0.5in;"><span style=""><span style=""><b><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></b></span></span></p>

<p class="MsoNormal" style="margin: 0in 0.5in 0.0001pt 61.5pt;"><span style=""><span style=""><b>Summary</b> <br>
When writing applications, you typically use the standard widgets provided by
SWT. On occasion, you will need to create your own custom widgets. For example,
you might want to add a new type of widget not provided by the standard
widgets, or extend the functionality of an existing widget.<span style="">&nbsp; </span>This article explains the different SWT
extension strategies and shows you how to use them. </span></span></p>

<p class="MsoNormal" style="margin: 0in 0.5in 0.0001pt 61.5pt;"><span style=""><span style=""><b><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></b></span></span></p>

<p class="MsoNormal" style="margin: 0in 0.5in 0.0001pt 61.5pt;"><span style=""><span style=""><b>By Steve Northover &amp; Carolyn MacLeod,
OTI<br>
</b></span></span><span style=""><span style=""><span style="font-size: 10pt;">March 22,
2001</span><b><o:p></o:p></b></span></span></p>

<p class="MsoNormal" style="margin: 0in 0.5in 0.0001pt 61.5pt;"><span style=""><span style=""><b><span style="font-size: 8pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></b></span></span></p>


<div class="MsoNormal" style="margin-left: 25.5pt; text-align: center;" align="center"><span style=""><span style="">

<hr align="center" size="2" width="100%">

</span></span></div>

<b><span style="font-size: 21pt; font-family: Arial;"><br style="page-break-before: always;" clear="all">
</span></b>

<h1 style="margin-left: 25.5pt;"><span style=""><span style="">Creating Your Own Widgets</span></span></h1>

<h2 style="margin-left: 25.5pt;"><a name="_Toc496069419"></a><a name="_Toc496069776"></a><a name="_Toc506634622"><span style=""><span style="">Overview</span></span></a></h2>

<p class="MsoNormal" style="margin-left: 25.5pt;">When writing applications, you
typically use the standard widgets provided by SWT. On occasion, you will need
to create your own custom widgets. There are several reasons that you might
want to do this:</p>

<p class="MsoNormal" style="margin-left: 43.5pt; text-indent: -0.25in;"><!--[if !supportLists]--><span style="font-family: Symbol;">·<span style="font-family: &quot;Times New Roman&quot;; font-style: normal; font-variant: normal; font-weight: normal; font-size: 7pt; line-height: normal; font-size-adjust: none; font-stretch: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><!--[endif]-->To add a new type of widget not provided by the
standard widgets</p>

<p class="MsoNormal" style="margin-left: 43.5pt; text-indent: -0.25in;"><!--[if !supportLists]--><span style="font-family: Symbol;">·<span style="font-family: &quot;Times New Roman&quot;; font-style: normal; font-variant: normal; font-weight: normal; font-size: 7pt; line-height: normal; font-size-adjust: none; font-stretch: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><!--[endif]-->To extend the functionality of an existing widget</p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;">Custom widgets are
created by subclassing in the existing widget class hierarchy.</p>

<h2 style="margin-left: 25.5pt;"><a name="_Toc506634623">Portability Issues</a></h2>

<p class="MsoNormal" style="margin-left: 25.5pt;">It is very important to think
about portability before writing a custom widget. SWT can be extended in the
following ways:</p>

<p class="MsoNormal" style="margin-left: 43.5pt; text-indent: -0.25in;"><!--[if !supportLists]--><span style="font-family: Symbol;">·<span style="font-family: &quot;Times New Roman&quot;; font-style: normal; font-variant: normal; font-weight: normal; font-size: 7pt; line-height: normal; font-size-adjust: none; font-stretch: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><!--[endif]-->Write a new widget that is 100% Java&#8482; portable</p>

<p class="MsoNormal" style="margin-left: 43.5pt; text-indent: -0.25in;"><!--[if !supportLists]--><span style="font-family: Symbol;">·<span style="font-family: &quot;Times New Roman&quot;; font-style: normal; font-variant: normal; font-weight: normal; font-size: 7pt; line-height: normal; font-size-adjust: none; font-stretch: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><!--[endif]-->Extend an existing widget in a 100% Java portable
manner</p>

<p class="MsoNormal" style="margin-left: 43.5pt; text-indent: -0.25in;"><!--[if !supportLists]--><span style="font-family: Symbol;">·<span style="font-family: &quot;Times New Roman&quot;; font-style: normal; font-variant: normal; font-weight: normal; font-size: 7pt; line-height: normal; font-size-adjust: none; font-stretch: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><!--[endif]-->Write a new widget that wraps an existing native widget
&#8211; not portable</p>

<p class="MsoNormal" style="margin-left: 43.5pt; text-indent: -0.25in;"><!--[if !supportLists]--><span style="font-family: Symbol;">·<span style="font-family: &quot;Times New Roman&quot;; font-style: normal; font-variant: normal; font-weight: normal; font-size: 7pt; line-height: normal; font-size-adjust: none; font-stretch: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><!--[endif]-->Extend an existing widget by calling natives &#8211; not
portable</p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;">In addition, a combination of
these can be used on different platforms:</p>

<p class="MsoNormal" style="margin-left: 43.5pt; text-indent: -0.25in;"><!--[if !supportLists]--><span style="font-family: Symbol;">·<span style="font-family: &quot;Times New Roman&quot;; font-style: normal; font-variant: normal; font-weight: normal; font-size: 7pt; line-height: normal; font-size-adjust: none; font-stretch: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><!--[endif]-->Write a new widget that wraps an existing native widget
on one platform, but is 100% Java portable on other platforms</p>

<p class="MsoNormal" style="margin-left: 43.5pt; text-indent: -0.25in;"><!--[if !supportLists]--><span style="font-family: Symbol;">·<span style="font-family: &quot;Times New Roman&quot;; font-style: normal; font-variant: normal; font-weight: normal; font-size: 7pt; line-height: normal; font-size-adjust: none; font-stretch: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><!--[endif]-->Extend an existing widget by calling natives on one
platform, but call 100% Java portable code on other platforms</p>

<p class="MsoNormal" style="margin-left: 25.5pt;">This of course involves
implementing the widget twice &#8211; using native calls on the one platform and
portable code on the others &#8211; while maintaining the same API for both.</p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;">Each SWT platform is shipped with
both a shared library (for example, a DLL on Windows®) and a jar (for the Java
class files). The shared library contains all of the native function required
for SWT, but it was not meant to be a complete set of the functions available
on the platform. Thus to expose native function or native widgets that were not
exposed by SWT, you need to write your own shared library. If you are using a
combination of native code on one platform and portable code on another, make
sure you call your shared library on the platform with the native widget, and
your jar on the platform with the portable widget.</p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;">One final note: SWT&#8217;s interface
to its shared libraries is internal SWT code. It was not meant to provide a framework
for applications to access all possible native function on all platforms &#8211; that
would be a daunting task. One of the purposes of this document is to show how
you can integrate C code with SWT, not model the operating system. As such, the
approach taken to writing natives in this document is different from the
approach taken by SWT.<br style="page-break-before: always;" clear="all">
</p>

<h2 style="margin-left: 25.5pt;"><a name="_Toc496069420"></a><a name="_Toc496069777"></a><a name="_Toc506634624"><span style=""><span style="">Writing Portable
Widgets</span></span></a></h2>

<p class="MsoNormal" style="margin-left: 25.5pt;">The SWT library
provides two widget classes that are typically used as the basis for a custom
100% Java portable widget:</p>

<p class="MsoNormal" style="margin-left: 43.5pt; text-indent: -0.25in;"><!--[if !supportLists]--><span style="font-family: Symbol;">·<span style="font-family: &quot;Times New Roman&quot;; font-style: normal; font-variant: normal; font-weight: normal; font-size: 7pt; line-height: normal; font-size-adjust: none; font-stretch: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><!--[endif]--><i style="">Canvas</i> - to
create basic widgets</p>

<p class="MsoNormal" style="margin-left: 43.5pt; text-indent: -0.25in;"><!--[if !supportLists]--><span style="font-family: Symbol;">·<span style="font-family: &quot;Times New Roman&quot;; font-style: normal; font-variant: normal; font-weight: normal; font-size: 7pt; line-height: normal; font-size-adjust: none; font-stretch: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><!--[endif]--><i style="">Composite</i> -
to create compound widgets</p>

<h3 style="margin-left: 25.5pt;"><a name="_Toc496069421"></a><a name="_Toc496069778"></a><a name="_Toc506634625"><span style=""><span style="">Basic Widgets</span></span></a></h3>

<p class="MsoNormal" style="margin-left: 25.5pt;">Basic widgets do
not contain any other widgets, and are not built from any other widgets. Basic
widgets draw themselves. An example of a basic widget is <i style="">Button</i>. Another example is <i style="">Text</i>.
To create a custom basic widget, subclass <i style="">Canvas</i>.</p>

<h3 style="margin-left: 25.5pt;"><a name="_Toc496069422"></a><a name="_Toc496069779"></a><a name="_Toc506634626"><span style=""><span style="">Compound Widgets</span></span></a></h3>

<p class="MsoNormal" style="margin-left: 25.5pt;">Compound widgets
contain other widgets, and/or are composed of other widgets. An example of a
compound widget is <i style="">Combo</i>. It contains
a <i style="">Text</i>, a <i style="">Button</i> and a <i style="">List</i>.
Another example is <i style="">Group</i>. It can contain
any number of children. To create a custom compound widget, subclass <i style="">Composite</i>.</p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;">The astute reader may have
noticed that <i style="">Canvas</i> is actually a
subclass of <i style="">Composite</i>. This is an
artifact of the underlying implementation. We treat <i style="">Canvas</i> as something you draw on and <i style="">Composite</i> as something that has children. Therefore the rule for
deciding which class to subclass is this: If your widget has or will have
children, subclass <i style="">Composite</i>. If your
widget does not have and never will have children, subclass <i style="">Canvas</i>.</p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;">Note also that we do not
distinguish between a compound widget that is intended to contain and lay out
children, and one that is merely composed of other widgets. Both will be a
subclass of <i style="">Composite</i>, and as such we
are describing implementation, rather than type, inheritance. When writing 100%
Java portable widgets, we can think of <i style="">Composite
</i>as the portable entry point into the SWT class hierarchy for all compound
widgets, and <i style="">Canvas </i>as the portable
entry point into the SWT class hierarchy for all basic widgets, regardless of
widget type.</p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<b><span style="font-size: 18pt; font-family: Arial;"><br style="page-break-before: always;" clear="all">
</span></b>

<h2 style="margin-left: 25.5pt;"><a name="_Toc496069423"></a><a name="_Toc496069780"><span style="">Basic Widget
Example</span></a><span style=""></span><span style=""></span><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;; font-weight: normal;"><o:p></o:p></span></h2>

<p class="MsoNormal" style="margin-left: 25.5pt;">Imagine we are
building an application where we need a widget that displays an image with a
line of text to the right, something like this:</p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if gte vml 1]><o:wrapblock><v:shapetype
  id="_x0000_t75" coordsize="21600,21600" o:spt="75" o:preferrelative="t"
  path="m@4@5l@4@11@9@11@9@5xe" filled="f" stroked="f">
  <v:stroke joinstyle="miter"/>
  <v:formulas>
   <v:f eqn="if lineDrawn pixelLineWidth 0"/>
   <v:f eqn="sum @0 1 0"/>
   <v:f eqn="sum 0 0 @1"/>
   <v:f eqn="prod @2 1 2"/>
   <v:f eqn="prod @3 21600 pixelWidth"/>
   <v:f eqn="prod @3 21600 pixelHeight"/>
   <v:f eqn="sum @0 0 1"/>
   <v:f eqn="prod @6 1 2"/>
   <v:f eqn="prod @7 21600 pixelWidth"/>
   <v:f eqn="sum @8 21600 0"/>
   <v:f eqn="prod @7 21600 pixelHeight"/>
   <v:f eqn="sum @10 21600 0"/>
  </v:formulas>
  <v:path o:extrusionok="f" gradientshapeok="t" o:connecttype="rect"/>
  <o:lock v:ext="edit" aspectratio="t"/>
 </v:shapetype><v:shape id="_x0000_s1033" type="#_x0000_t75" style='position:absolute;
  left:0;text-align:left;margin-left:154.8pt;margin-top:-14.25pt;width:51.75pt;
  height:17.25pt;z-index:3;mso-position-horizontal-relative:text;
  mso-position-vertical-relative:text' o:allowincell="f">
  <v:imagedata src="./Writing%20Your%20Own%20Widget_files/image001.png"
   o:title=""/>
  <w:wrap type="topAndBottom" anchorx="page"/>
 </v:shape><![if gte mso 9]><o:OLEObject Type="Embed" ProgID="PBrush"
  ShapeID="_x0000_s1033" DrawAspect="Content" ObjectID="_1053168690">
 </o:OLEObject>
 <![endif]><![endif]--><!--[if !vml]--><span style="">
 <table align="left" cellpadding="0" cellspacing="0">
  <tbody><tr>
   <td height="0" width="206"></td>
  </tr>
  <tr>
   <td></td>
   <td><img src="Writing%20Your%20Own%20Widget_files/image002.jpg" v:shapes="_x0000_s1033" height="23" width="69"></td>
  </tr>
 </tbody></table>
 </span><!--[endif]--><!--[if gte vml 1]></o:wrapblock><![endif]--><br style="" clear="all">
<!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p><p></p>

<br style="" clear="all">

<p class="MsoNormal" style="margin-left: 25.5pt;">Since we plan to
draw both the image and the text, we subclass <i style="">Canvas</i>.</p>

<p style="margin: 0in 0in 0.0001pt 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">import</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> org.eclipse.swt.*;<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">import</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
org.eclipse.swt.graphics.*;<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">import</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> org.eclipse.swt.widgets.*;<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">import</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> org.eclipse.swt.events.*;<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">public</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">class</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> PictureLabel </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">extends</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> Canvas {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>Image image;<span style="">&nbsp; </span><o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>String text;<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;">Our widget needs to
be created. To do this, we must write at least one constructor. Because widgets
in SWT cannot be created without a parent, the constructor must take at least
one argument that is the parent. The convention in SWT is to have a constructor
with two arguments, <b style="">parent</b> and <b style="">style</b>. Style bits are used to control
the look of widgets. Neither the parent nor the style bits can be changed after
the widget is created. Your widget can use style bits too.</p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>PictureLabel(Composite parent, </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">int</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
style) {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">super</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">(parent, style);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>}<span style="">&nbsp; </span><o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;">The parent of any
widget must be a <i style="">Composite</i>. The style
is an integer, where some bits are already used by the system. For example, <b style=""><span style="font-size: 10pt;">SWT.BORDER</span></b>
will cause a <i style="">Canvas</i> to have a border.</p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;">Next we need to
initialize our widget. The convention in SWT is to do all initialization in the
constructor. Certainly, any initialization that requires the parent or the
style bits must be done here. We have decided that our <i style="">PictureLabel</i> widget will default to a white background, so we need
to add a <i style="">Color</i> field, allocate a <i style="">Color</i>, and initialize the background.</p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">public</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">class</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> PictureLabel </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">extends</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> Canvas {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>Image image;<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>String text;<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>Color white;<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span><o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>PictureLabel(Composite parent, </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">int</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
style) {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">super</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">(parent, style);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>white = </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">new</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
Color(</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">null</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">, 255, 255, 255);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>setBackground(white);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;">Colors are graphics
resources that must be disposed. How can we dispose of the white color that we
allocated? We add a dispose listener. Every widget provides notification when
it is destroyed. We add the dispose listener in the constructor.</p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>addDisposeListener(</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">new</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
DisposeListener() {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">public</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">void</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
widgetDisposed(DisposeEvent e) {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>white.dispose();<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>});<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><b style="">Note:</b> Do not just override dispose() to
release the color. This only works in the case where dispose is actually sent
to the widget. When the shell is disposed this does not happen, so overriding
dispose will leak the color. To ensure that your widget is informed of an event
no matter how it was generated, add an event listener instead of overriding
methods that generate events. </p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;">Our widget is
created and initialized, and it can be destroyed without leaking graphics
resources. Now it needs some functionality. We need to draw the image and the
text, and this will require another listener: the paint listener. Implementing
a widget often requires adding many listeners. We could implement the listener
interfaces as part of our new widget class, but that would make the interface
methods public in our class. Instead, the SWT convention is to use anonymous inner
classes to forward the functionality to non-public methods of the same name.
For consistency, we will rewrite the dispose listener to follow this
convention, moving the color dispose code into the <b style="">widgetDisposed</b> method. We write the paint listener the same way.</p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>addDisposeListener(</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">new</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
DisposeListener() {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">public</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">void</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
widgetDisposed(DisposeEvent e) {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>PictureLabel.</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">this</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">.widgetDisposed(e);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>});<span style=""> </span><o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>addPaintListener(</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">new</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
PaintListener() {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">public</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">void</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> paintControl(PaintEvent e)
{<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>PictureLabel.</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">this</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">.paintControl(e);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>});<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;">By choosing the
same names, we have the option of easily implementing the interfaces if we
decide to do so later. Here is the <b style="">paintControl</b>
method to draw the widget.</p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">void</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> paintControl(PaintEvent e)
{<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>GC gc = e.gc;<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">int</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> x = 1;<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">if</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> (image != </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">null</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">) {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>gc.drawImage(image, x, 1); <o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>x = image.getBounds().width + 5;<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">if</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> (text != </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">null</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">) {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>gc.drawString(text, x, 1);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>}<span style="">&nbsp; </span><o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>}<o:p></o:p></span></p>

<p style="margin: 0in 0in 0.0001pt 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;">Now we can draw the
image and the text, but we need to let the user set them. So we write set and
get methods for each of them.</p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">public</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> Image getImage() {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">return</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> image;<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">public</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">void</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> setImage(Image image) {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">this</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">.image = image;<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>redraw();<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">public</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> String getText() {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">return</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> text;<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">public</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">void</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> setText(String text) {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">this</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">.text = text;<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>redraw();<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;">The get methods are
trivial. They simply answer the fields. The set methods set the fields and then
redraw the widget to show the change. The easiest way to do this is to damage
the widget by calling <b style="">redraw()</b>,
which queues a paint event for the widget. This approach has the advantage that
setting both the image and the text will cause only one paint event because
multiple paints are collapsed in the event queue.</p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;">We are not done
yet. Our widget does not know its preferred size. This information is needed in
order to lay out the widget. In our case, the best size is simply the size of
the text plus the size of the image, plus a little bit of space in between.
Also, we will add a 1 pixel margin all the way around.</p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;">To return the
preferred size of the widget, we must implement the <b style="">computeSize</b> method. The <b style="">computeSize</b>
method can be quite complicated. Its job is to calculate the preferred size of
the widget based on the current contents. The simplest implementation ignores
the arguments and just computes the size.</p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">public</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> Point computeSize(</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">int</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> wHint, </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">int</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> hHint, </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">boolean</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> changed) {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">int</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> width = 0, height = 0;<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">if</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> (image != </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">null</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">) {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Rectangle bounds = image.getBounds();<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>width = bounds.width + 5;<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>height = bounds.height;<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">if</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> (text != </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">null</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">) {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>GC gc = </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">new</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
GC(</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">this</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Point extent = gc.stringExtent(text);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>gc.dispose();<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>width += extent.x;<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>height = Math.max(height, extent.y);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">return</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">new</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> Point(width + 2, height +
2);<span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span><o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;">What are <b style="">wHint</b>, <b style="">hHint</b>, and <b style="">changed</b>? The
hint arguments allow you to ask a widget questions such as &#8220;Given a particular
width, how high does the widget need to be to show all of the contents&#8221;? For
example, a word-wrapping <i style="">Label</i> widget
might be asked this. To indicate that the client does not care about a
particular hint, the special value <b style=""><span style="font-size: 10pt;">SWT.DEFAULT</span></b> is used. The following example
asks a label for its preferred size given a width of 100 pixels: </p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>Point extent = label.computeSize(100, </span><span style="font-size: 8pt; font-family: &quot;Courier New&quot;; color: black;">SWT.DEFAULT</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">, </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">false</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;">For our <i style="">PictureLabel</i> widget, we could be fancy
and stack the image over the text when the width is too small, and/or wrap the text
in order to meet a width request, but for simplicity we have decided not to do
so. Still, we need to honour the hints. So, our widget will clip. The easiest
way to do this is to perform the calculation and then filter the results.</p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">public</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> Point computeSize(</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">int</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> wHint, </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">int</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> hHint, </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">boolean</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> changed) {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">int</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> width = 0, height = 0;<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">if</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> (image != </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">null</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">) {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Rectangle bounds = image.getBounds();<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>width = bounds.width + 5;<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>height = bounds.height;<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">if</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> (text != </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">null</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">) {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>GC gc = </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">new</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
GC(</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">this</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Point extent = gc.stringExtent(text);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>gc.dispose();<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>width += extent.x;<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>height = Math.max(height, extent.y);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">if</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> (wHint != </span><span style="font-size: 8pt; font-family: &quot;Courier New&quot;; color: black;">SWT.DEFAULT</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">) width = wHint;<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">if</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> (hHint != </span><span style="font-size: 8pt; font-family: &quot;Courier New&quot;; color: black;">SWT.DEFAULT</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">) height = hHint;<span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">return</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">new</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> Point(width + 2, height +
2);<span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span><o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;">Notice that we do
not return the hint sizes exactly as specified. We have added the 1-pixel
border. Why do we do this? All widgets have a <i style="">client area</i> and <i style="">trim</i>. The
hint parameters specify the desired size of the client area. We must set the
size of the widget so that the size of the client area is the same as the hint,
so the size we return from <b style="">computeSize</b>
must include the trim.</p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;">What about the <b style="">changed</b> flag? This is used in
conjunction with SWT layout managers and is ignored for basic widgets. This
will be discussed when we talk about compound widgets.</p>

<span style="font-size: 18pt; font-family: Arial;"><br style="page-break-before: always;" clear="all">
</span>

<h2 style="margin-left: 25.5pt;"><a name="_Toc496069424"></a><a name="_Toc496069781"></a><a name="_Ref506190201"></a><a name="_Toc506634627"><span style=""><span style=""><span style="">Compound Widget Example</span></span></span></a></h2>

<p class="MsoNormal" style="margin-left: 25.5pt;">Now we will recode
the <i style="">PictureLabel</i> widget as a compound
widget. Note that this section assumes that you have read the basic widget
example section. This time the widget will be implemented using two <i style="">Label</i> children: one to display the
image, and one to display the text. Since we are using other widgets to
implement our widget, we subclass <i style="">Composite</i>.</p>

<p class="Code" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">public</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">class</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> PictureLabel </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">extends</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> Composite {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>Label image, text;<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>Color white;<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span><o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>PictureLabel(Composite parent, </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">int</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
style) {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">super</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">(parent, style);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>white = </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">new</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
Color(</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">null</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">, 255, 255, 255);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>image = </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">new</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
Label(</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">this</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">, 0);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>text = </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">new</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
Label(</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">this</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">, 0);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>setBackground(white);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>image.setBackground(white);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>text.setBackground(white);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>addDisposeListener(</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">new</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
DisposeListener() {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">public</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">void</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
widgetDisposed(DisposeEvent e) {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>PictureLabel.</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">this</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">.widgetDisposed(e);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>});<span style=""> </span><o:p></o:p></span></p>

<p class="Code" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;">As well as
initializing the graphics resources in the constructor, we need to create the child
widgets and set their background color. A common mistake is to create the child
widgets as children of the parent. This would make them peers of our widget.
Instead, make sure to create them as children of <b style="">this</b>. The dispose listener frees the color, as before.</p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;">Now that we have
handled creation and destruction, we need to lay out the children. There are
two possibilities:</p>

<p class="MsoNormal" style="margin-left: 43.5pt; text-indent: -0.25in;"><!--[if !supportLists]--><span style="font-family: Symbol;">·<span style="font-family: &quot;Times New Roman&quot;; font-style: normal; font-variant: normal; font-weight: normal; font-size: 7pt; line-height: normal; font-size-adjust: none; font-stretch: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><!--[endif]-->position the children when the widget is resized</p>

<p class="MsoNormal" style="margin-left: 43.5pt; text-indent: -0.25in;"><!--[if !supportLists]--><span style="font-family: Symbol;">·<span style="font-family: &quot;Times New Roman&quot;; font-style: normal; font-variant: normal; font-weight: normal; font-size: 7pt; line-height: normal; font-size-adjust: none; font-stretch: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><!--[endif]-->use a layout manager</p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;">We will implement
both here for comparison.</p>

<h3 style="margin-left: 25.5pt;"><a name="_Toc496069425"></a><a name="_Toc496069782"></a><a name="_Toc506634628"><span style=""><span style="">Positioning Children on
Resize</span></span></a></h3>

<p class="MsoNormal" style="margin-left: 25.5pt;">First, we will
position the children when the widget is resized. We need to add a resize
listener.</p>

<p class="Code" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>addControlListener(</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">new</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
ControlAdapter() {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">public</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">void</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
controlResized(ControlEvent e) {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>PictureLabel.</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">this</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">.controlResized(e);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>});<span style=""> </span><o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">void</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
controlResized(ControlEvent e) {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>Point iExtent = image.computeSize(</span><span style="font-size: 8pt; font-family: &quot;Courier New&quot;; color: black;">SWT.DEFAULT</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">, </span><span style="font-size: 8pt; font-family: &quot;Courier New&quot;; color: black;">SWT.DEFAULT</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">, </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">false</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>Point tExtent = text.computeSize(</span><span style="font-size: 8pt; font-family: &quot;Courier New&quot;; color: black;">SWT.DEFAULT</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">, </span><span style="font-size: 8pt; font-family: &quot;Courier New&quot;; color: black;">SWT.DEFAULT</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">, </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">false</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>image.setBounds(1, 1, iExtent.x, iExtent.y);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>text.setBounds(iExtent.x + 5, 1, tExtent.x, tExtent.y);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>}<o:p></o:p></span></p>

<p class="Code" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;">When the widget is
resized, we compute the size of each of our children, and then use their
extents and our 5-pixel spacing and 1-pixel margin to position the children
using <b style="">setBounds</b>.</p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;">Now we will write
the set and get methods. Because we are not drawing the image and text,
damaging the widget will not cause the correct behavior. The children must be
resized to show their new contents. To do this, we will take the code from the
resize listener and move it into a helper method called <b style="">resize</b>.</p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">void</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
controlResized(ControlEvent e) {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>resize();<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span><o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">void</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> resize() {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>Point iExtent = image.computeSize(</span><span style="font-size: 8pt; font-family: &quot;Courier New&quot;; color: black;">SWT.DEFAULT</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">, </span><span style="font-size: 8pt; font-family: &quot;Courier New&quot;; color: black;">SWT.DEFAULT</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">, </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">false</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>Point tExtent = text.computeSize(</span><span style="font-size: 8pt; font-family: &quot;Courier New&quot;; color: black;">SWT.DEFAULT</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">, </span><span style="font-size: 8pt; font-family: &quot;Courier New&quot;; color: black;">SWT.DEFAULT</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">, </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">false</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>image.setBounds(1, 1, iExtent.x, iExtent.y);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>text.setBounds(iExtent.x + 5, 1, tExtent.x, tExtent.y);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;">Here are the set
and get methods.</p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">public</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> Image getImage() {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">return</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> image.getImage();<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">public</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">void</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> setImage(Image image) {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">this</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">.image.setImage(image);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>resize();<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">public</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> String getText() {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">return</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> text.getText();<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">public</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">void</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> setText(String text) {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">this</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">.text.setText(text);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>resize();<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>}<o:p></o:p></span></p>

<p style="margin: 0in 0in 0.0001pt 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;">Now we have to
implement the <b style="">computeSize</b> method. This
is a simple matter of asking the children for their preferred sizes.</p>

<p style="margin: 0in 0in 0.0001pt 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">public</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> Point computeSize(</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">int</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> wHint, </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">int</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> hHint, </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">boolean</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> changed) {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>Point iExtent = image.computeSize(</span><span style="font-size: 8pt; font-family: &quot;Courier New&quot;; color: black;">SWT.DEFAULT</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">, </span><span style="font-size: 8pt; font-family: &quot;Courier New&quot;; color: black;">SWT.DEFAULT</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">, </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">false</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>Point tExtent = text.computeSize(</span><span style="font-size: 8pt; font-family: &quot;Courier New&quot;; color: black;">SWT.DEFAULT</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">, </span><span style="font-size: 8pt; font-family: &quot;Courier New&quot;; color: black;">SWT.DEFAULT</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">, </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">false</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">int</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> width = iExtent.x + 5 +
tExtent.x;<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">int</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> height =
Math.max(iExtent.y, tExtent.y);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">if</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> (wHint != </span><span style="font-size: 8pt; font-family: &quot;Courier New&quot;; color: black;">SWT.DEFAULT</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">) width = wHint;<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">if</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> (hHint != </span><span style="font-size: 8pt; font-family: &quot;Courier New&quot;; color: black;">SWT.DEFAULT</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">) height = hHint;<span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">return</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">new</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> Point(width + 2, height +
2);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<h3 style="margin-left: 25.5pt;"><a name="_Toc496069426"></a><a name="_Toc496069783"></a><a name="_Toc506634629"><span style=""><span style="">Positioning Children
With a Layout Manager</span></span></a></h3>

<p class="MsoNormal" style="margin-left: 25.5pt;">Now we will rewrite
our compound widget example using a layout manager to position our widget&#8217;s
children. We could just use an existing SWT layout manager - <i style="">RowLayout</i> - to position the children,
but we promised to explain the <b style="">changed</b>
parameter in the <b style="">computeSize</b> method.
This also gives an example of how this might be done for more complicated
layout requirements. In the code that follows, the class <i style="">PictureLabelLayout</i> extends <i style="">Layout</i>,
and the rewritten <i style="">PictureLabel</i> class
is listed in its entirety.</p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;">The layout manager
is set into the widget with the following line of code in the widget
constructor:</p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>setLayout(</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">new</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
PictureLabelLayout());<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;">We will call the
layout manager in the widget&#8217;s two <b style="">set</b>
methods, with the following line of code:</p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>layout(</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">true</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;">The parameter to
the <b style="">layout</b> method is the <b style="">changed</b> flag. If <b style="">true</b>, it indicates that the widget contents have changed (as is the
case in the two <b style="">set </b>methods),
therefore any caches that the layout manager may have been keeping need to be
flushed. When the widget is resized, the SWT system sends <b style="">layout(false)</b> to the layout manager, so caches do not need to be
flushed. This lets the layout manager perform any expensive calculations only
when necessary.</p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;">In class <i style="">PictureLabelLayout</i>, we know that <b style="">composite.getChildren()</b> will always
return exactly two children. In general, a layout manager will have to handle
any number of children, so if you are implementing a widget that can have an
arbitrary number of children you will need to loop through them to do your
calculations. Note that it is in this class that we check the value of the <b style="">changed</b> flag and optionally flush our
two &#8220;extent&#8221; caches.</p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;">Notice that the <i style="">PictureLabel</i> class has been simplified
by using a layout manager. The code in <b style="">computeSize</b>
and <b style="">resize</b> has been moved to the <i style="">PictureLabelLayout</i> class, and the resize
listener is no longer needed.</p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">import</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> org.eclipse.swt.*;<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">import</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
org.eclipse.swt.graphics.*;<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">import</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> org.eclipse.swt.widgets.*;<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">import</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> org.eclipse.swt.events.*;<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">class</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> PictureLabelLayout </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">extends</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> Layout {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>Point iExtent, tExtent; </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: maroon;">// the cached sizes</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">protected</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> Point
computeSize(Composite composite, </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">int</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
wHint, </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">int</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> hHint,<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">boolean</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> changed) {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>Control [] children = composite.getChildren();<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">if</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> (changed || iExtent == </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">null</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> || tExtent == </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">null</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">) {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>iExtent = children[0].computeSize(</span><span style="font-size: 8pt; font-family: &quot;Courier New&quot;; color: black;">SWT.DEFAULT</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">, </span><span style="font-size: 8pt; font-family: &quot;Courier New&quot;; color: black;">SWT.DEFAULT</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">, </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">false</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>tExtent = children[1].computeSize(</span><span style="font-size: 8pt; font-family: &quot;Courier New&quot;; color: black;">SWT.DEFAULT</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">, </span><span style="font-size: 8pt; font-family: &quot;Courier New&quot;; color: black;">SWT.DEFAULT</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">, </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">false</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">int</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> width = iExtent.x + 5 +
tExtent.x;<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">int</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> height = Math.max(iExtent.y,
tExtent.y);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">return</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">new</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> Point(width + 2, height +
2);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">protected</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">void</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> layout(Composite
composite, </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">boolean</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> changed) {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>Control [] children = composite.getChildren();<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">if</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> (changed || iExtent == </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">null</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> || tExtent == </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">null</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">) {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>iExtent = children[0].computeSize(</span><span style="font-size: 8pt; font-family: &quot;Courier New&quot;; color: black;">SWT.DEFAULT</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">, </span><span style="font-size: 8pt; font-family: &quot;Courier New&quot;; color: black;">SWT.DEFAULT</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">, </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">false</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>tExtent = children[1].computeSize(</span><span style="font-size: 8pt; font-family: &quot;Courier New&quot;; color: black;">SWT.DEFAULT</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">, </span><span style="font-size: 8pt; font-family: &quot;Courier New&quot;; color: black;">SWT.DEFAULT</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">, </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">false</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>children[0].setBounds(1, 1, iExtent.x, iExtent.y);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>children[1].setBounds(iExtent.x + 5, 1, tExtent.x, tExtent.y);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">public</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">class</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> PictureLabel </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">extends</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> Composite {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>Label image, text;<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>Color white;<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span><o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>PictureLabel(Composite parent, </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">int</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
style) {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">super</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">(parent, style);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>white = </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">new</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
Color(</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">null</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">, 255, 255, 255);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>image = </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">new</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
Label(</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">this</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">, 0);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>text = </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">new</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
Label(</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">this</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">, 0);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>setBackground(white);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>text.setBackground(white);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>image.setBackground(white);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>addDisposeListener(</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">new</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
DisposeListener() {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">public</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">void</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
widgetDisposed(DisposeEvent e) {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>PictureLabel.</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">this</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">.widgetDisposed(e);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>});<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>setLayout(</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">new</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> PictureLabelLayout());<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span><o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">void</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
widgetDisposed(DisposeEvent e) {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>white.dispose();<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span><o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">public</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> Image getImage() {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">return</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> image.getImage();<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">public</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">void</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> setImage(Image image) {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">this</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">.image.setImage(image);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>layout(</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">true</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">public</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> String getText() {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">return</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> text.getText();<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">public</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">void</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> setText(String text) {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">this</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">.text.setText(text);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>layout(</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">true</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">}<o:p></o:p></span></p>

<span style="font-size: 18pt; font-family: Arial;"><br style="page-break-before: always;" clear="all">
</span>

<h2 style="margin-left: 25.5pt;"><a name="_Toc506634630">Events and
Listeners</a></h2>

<p class="MsoNormal" style="margin-left: 25.5pt;">Often, you will
want a new widget to support an event. For example, you may want your widget to
notify listeners when the user selects it. Or you may have an editable widget
that should notify listeners when its value has changed.</p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;">The details to
implement an event called <i style="">AnEvent</i> are
<b style=""><i style="">exactly</i></b>
the same as implementing a Java Bean listener:</p>

<p class="MsoNormal" style="margin-left: 43.5pt; text-indent: -0.25in;"><!--[if !supportLists]--><span style="font-family: Symbol;">·<span style="font-family: &quot;Times New Roman&quot;; font-style: normal; font-variant: normal; font-weight: normal; font-size: 7pt; line-height: normal; font-size-adjust: none; font-stretch: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><!--[endif]-->create a class called <i style="">AnEvent </i>which extends <i style="">java.util.EventObject</i>
and may have additional fields related to the event. Usually you want to
provide get methods for event fields, but you do not always want to provide set
methods. Fields are typically set in the constructor.</p>

<p class="MsoNormal" style="margin-left: 43.5pt; text-indent: -0.25in;"><!--[if !supportLists]--><span style="font-family: Symbol;">·<span style="font-family: &quot;Times New Roman&quot;; font-style: normal; font-variant: normal; font-weight: normal; font-size: 7pt; line-height: normal; font-size-adjust: none; font-stretch: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><!--[endif]-->create a class called <i style="">AnEventListener </i>which implements the <i style="">java.util.EventListener </i>interface and provides a method called,
say, <b style="">anEventHappened(AnEvent event)</b></p>

<p class="MsoNormal" style="margin-left: 43.5pt; text-indent: -0.25in;"><!--[if !supportLists]--><span style="font-family: Symbol;">·<span style="font-family: &quot;Times New Roman&quot;; font-style: normal; font-variant: normal; font-weight: normal; font-size: 7pt; line-height: normal; font-size-adjust: none; font-stretch: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><!--[endif]-->keep a <i style="">Vector</i>
(or some other collection) of <i style="">AnEventListener</i>&#8217;s
in your widget class</p>

<p class="MsoNormal" style="margin-left: 43.5pt; text-indent: -0.25in;"><!--[if !supportLists]--><span style="font-family: Symbol;">·<span style="font-family: &quot;Times New Roman&quot;; font-style: normal; font-variant: normal; font-weight: normal; font-size: 7pt; line-height: normal; font-size-adjust: none; font-stretch: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><!--[endif]-->implement <b style="">addAnEventListener</b>
which adds the specified listener to the <i style="">Vector</i></p>

<p class="MsoNormal" style="margin-left: 43.5pt; text-indent: -0.25in;"><!--[if !supportLists]--><span style="font-family: Symbol;">·<span style="font-family: &quot;Times New Roman&quot;; font-style: normal; font-variant: normal; font-weight: normal; font-size: 7pt; line-height: normal; font-size-adjust: none; font-stretch: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><!--[endif]-->implement <b style="">removeAnEventListener</b>
to remove the specified listener from the <i style="">Vector</i></p>

<p class="MsoNormal" style="margin-left: 43.5pt; text-indent: -0.25in;"><!--[if !supportLists]--><span style="font-family: Symbol;">·<span style="font-family: &quot;Times New Roman&quot;; font-style: normal; font-variant: normal; font-weight: normal; font-size: 7pt; line-height: normal; font-size-adjust: none; font-stretch: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><!--[endif]-->determine when the event happens in your widget
(possibly by adding listeners to your widget) and when it does:</p>

<p class="MsoNormal" style="margin-left: 61.5pt; text-indent: -0.25in;"><!--[if !supportLists]--><span style="font-family: Symbol;">·<span style="font-family: &quot;Times New Roman&quot;; font-style: normal; font-variant: normal; font-weight: normal; font-size: 7pt; line-height: normal; font-size-adjust: none; font-stretch: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><!--[endif]-->create an instance of <i style="">AnEvent</i> called <b style="">event</b>,
initialized as appropriate</p>

<p class="MsoNormal" style="margin-left: 61.5pt; text-indent: -0.25in;"><!--[if !supportLists]--><span style="font-family: Symbol;">·<span style="font-family: &quot;Times New Roman&quot;; font-style: normal; font-variant: normal; font-weight: normal; font-size: 7pt; line-height: normal; font-size-adjust: none; font-stretch: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><!--[endif]-->send <b style="">anEventHappened(event)</b>
to each of the <i style="">AnEventListener</i>&#8217;s in
the <i style="">Vector</i></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><b style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></b></p>

<p class="MsoNormal" style="margin-left: 25.5pt;">Say we want <i style="">PictureLabel</i> widgets to notify listeners
when the user clicks the left mouse button in the image. We create class <i style="">ImageClickedEvent</i> with <b style="">x</b> and <b style="">y</b> fields, and interface <i style="">ImageClickedListener</i>
with method <b style="">imageClicked(ImageClickedEvent
event)</b>. </p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">public</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">class</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
ImageClickedEvent </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">extends</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> java.util.EventObject {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">public</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">int</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> x, y;<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">public</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> ImageClickedEvent(Object source, </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">int</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> x, </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">int</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> y) {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">super</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">(source);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">this</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">.x = x;<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">this</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">.y = y;<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">public</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">interface</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
ImageClickedListener </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">extends</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> java.util.EventListener {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">public</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">void</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> imageClicked(ImageClickedEvent event);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;">We add a <i style="">Vector</i> to <i style="">PictureLabel</i> to store the listeners:</p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>Vector imageClickedListeners = </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">new</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
Vector();<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">public</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">void</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
addImageClickedListener(ImageClickedListener listener) {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>imageClickedListeners.addElement(listener);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span><o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">public</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">void</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> removeImageClickedListener(ImageClickedListener
listener) {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>imageClickedListeners.removeElement(listener);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;">Finally, in <i style="">PictureLabel</i>&#8217;s constructor, we add a
mouse listener to the image <i style="">Label</i>
widget, which does the work of notifying the listeners when the left mouse
button is clicked over the image.</p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>&#8230;<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>addMouseListener(</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">new</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
MouseAdapter() {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">public</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">void</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> mouseDown(MouseEvent event) {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">if</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> (event.button == 1) {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>PictureLabel.</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">this</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">.mouseDown(event);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>});<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">public</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">void</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> mouseDown(MouseEvent event) {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>ImageClickedEvent e = </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">new</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
ImageClickedEvent(</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">this</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">, event.x, event.y);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">int</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> size = imageClickedListeners.size();<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">for</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> (</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">int</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> i = 0; i &lt; size; i++) {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>ImageClickedListener listener =<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>(ImageClickedListener) imageClickedListeners.elementAt(i);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>listener.imageClicked(e);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>}<o:p></o:p></span></p>

<span style="font-size: 18pt; font-family: Arial;"><br style="page-break-before: always;" clear="all">
</span>

<h2 style="margin-left: 25.5pt;"><a name="_Toc496069427"></a><a name="_Toc496069784"></a><a name="_Toc506634631"><span style=""><span style="">Sample Application</span></span></a></h2>

<p class="MsoNormal" style="margin-left: 25.5pt;">Now we will use the
new widget in an example application. The application simply creates a shell
with a <i style="">PictureLabel</i> child. Then it
sets the <i style="">PictureLabel</i>&#8217;s image to a
little red square, and text to &#8220;Hi there!&#8221;. There is no <i style="">Layout</i> manager for the shell, so we will set the <i style="">PictureLabel</i>&#8217;s size. When the image is
clicked, we change the text to &#8220;Red!&#8221;.</p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;">Here is the
application code:</p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">import</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> org.eclipse.swt.graphics.*;</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: maroon;"><o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">import</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> org.eclipse.swt.widgets.*;</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: maroon;"><o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">public</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">class</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> PictureLabelExample {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">public</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">static</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">void</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> main(String [] args) {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>Image image = </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">new</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
Image(</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">null</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">, 20, 20);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>Color red = </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">new</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
Color(</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">null</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">, 255, 0, 0);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>GC gc = </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">new</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
GC(image);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>gc.setBackground(red);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>gc.fillRectangle(image.getBounds());<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>gc.dispose();<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>red.dispose();<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>Shell shell = </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">new</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
Shell();<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>PictureLabel label = </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">new</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
PictureLabel(shell, 0);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>label.setImage(image);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>label.setText(</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: teal;">"Hi there!"</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>Point size = label.computeSize(SWT.DEFAULT, SWT.DEFAULT, false);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>label.setSize(size);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>label.addImageClickedListener(new ImageClickedListener() {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">public</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">void</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> imageClicked(ImageClickedEvent event) {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>((PictureLabel) event.getSource()).</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">setText(</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: teal;">"Red!"</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">);<span style=""><o:p></o:p></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>});</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>shell.open();<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>Display display = shell.getDisplay();<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">while</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> (!shell.isDisposed()) {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">if</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
(!display.readAndDispatch()) display.sleep();<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>image.dispose();<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;">And here is what
you see when you run it:</p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<div style="">

<table cellpadding="0" cellspacing="0" hspace="0" vspace="0">
 <tbody><tr>
  <td style="padding: 0in 9pt;" align="left" valign="top">
  <p class="MsoNormal" style="margin-left: 25.5pt; text-align: center;" align="center"><span style="font-size: 10pt;"><!--[if gte vml 1]><v:shape id="_x0000_i1046" type="#_x0000_t75"
   style='width:99.75pt;height:82.5pt' fillcolor="window">
   <v:imagedata src="./Writing%20Your%20Own%20Widget_files/image003.png"
    o:title=""/>
  </v:shape><![endif]--><!--[if !vml]--><img src="Writing%20Your%20Own%20Widget_files/image004.jpg" v:shapes="_x0000_i1046" height="110" width="133"><!--[endif]--></span></p>
  </td>
 </tr>
</tbody></table>

</div>

<p class="MsoNormal" style="margin-left: 25.5pt; text-align: center;" align="center"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt; text-align: center;" align="center"><b style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></b></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><b style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></b></p>

<p class="MsoNormal" style="margin-left: 25.5pt; text-align: center;" align="center"><b style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></b></p>

<p class="MsoNormal" style="margin-left: 25.5pt; text-align: center;" align="center"><b style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></b></p>

<p class="MsoNormal" style="margin-left: 25.5pt; text-align: center;" align="center"><b style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></b></p>

<p class="MsoNormal" style="margin-left: 25.5pt; text-align: center;" align="center"><b style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></b></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><b style="">A PictureLabel in a Shell<o:p></o:p></b></p>

<h2 style="margin-left: 25.5pt;"><a name="_Ref498250831"></a><a name="_Toc506634632"><span style="">Advanced Issues</span></a></h2>

<p class="MsoNormal" style="margin-left: 25.5pt;">We have discussed
the basics of creating a custom widget: subclassing <i style="">Canvas</i> or <i style="">Composite</i>,
creating and initializing, setting and getting the widget&#8217;s resources, drawing,
disposing graphics resources, size and layout, and providing events and listeners.
There are some advanced issues that you may need to deal with when you
implement a new widget.</p>

<h3 style="margin-left: 25.5pt;"><a name="_Toc506634633">SWT Event
Mechanism</a></h3>

<p class="MsoNormal" style="margin-left: 25.5pt;">SWT provides a low-level listener
mechanism as well as the usual Java &#8216;typed&#8217; listeners. Every SWT widget
understands <b style="">addListener(int eventType,
Listener listener)</b> and <b style="">notifyListeners(int
eventType, Event event)</b>. The <b style="">eventType</b>
constants are defined in class <i style="">SWT</i>.
When an event occurs, the widget creates an SWT <i style="">Event</i> object containing the appropriate type constant. The <b style="">notifyListeners </b>method<b style=""> </b>calls <b style="">handleEvent(Event event)</b> for the <i style="">Listener</i>. If you need to reuse an existing SWT event, you would
typically use this mechanism.</p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;">For example, if your widget
implements a selection event, you could implement your &#8216;typed&#8217; add and remove
methods as follows:</p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">public</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">void</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
addSelectionListener(SelectionListener listener) {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>addListener(SWT.Selection, </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">new</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
TypedListener(listener));<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">public</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">void</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
removeSelectionListener(SelectionListener listener) {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>removeListener(SWT.Selection, listener);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><br>
When the &#8216;selection event&#8217; occurs in your widget (say, when <b style="">child1</b> is selected), you notify the
application&#8217;s selection listeners using <b style="">notifyListeners</b>.</p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>child1.addListener(SWT.Selection, </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">new</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
Listener() {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">public</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">void</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> handleEvent(Event e) {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>notifyListeners(SWT.Selection, </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">new</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
Event());<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>});<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;">Note that when we add the
listener we first wrap it in a <i style="">TypedListener</i>.
This is because<i style=""> TypedListener</i>&#8217;s <b style="">handleEvent(Event event)</b> method creates
the appropriate <i style="">TypedEvent</i> subclass
based on the type in the <i style="">Event</i>, and
then calls the appropriate method for the typed event. In this way,
applications can add Java typed listeners to widgets, but widget
implementations can use the more efficient low-level listener mechanism. Make
sure that your widget implementation provides a typed listener API, however.
Applications should not be calling low-level listener methods. The typed
listener methods prevent accidental programming errors such as assuming that
all widgets can handle all types of event, or that all fields in the <i style="">Event</i> class are valid for all events.</p>

<span style="font-size: 14pt; font-family: Arial;"><br style="page-break-before: always;" clear="all">
</span>

<h3 style="margin-left: 25.5pt;"><a name="_Toc506634634"><span style="">&nbsp;</span>Wrapping an SWT Widget</a></h3>

<p class="MsoNormal" style="margin-left: 25.5pt;">Occasionally, you
may find that the best way to implement a new widget is by wrapping an existing
SWT widget. For example, to implement a <i style="">TableTree</i>,
you might want to use a <i style="">Table</i>. To do
this, create <i style="">TableTree</i> as a subclass
of <i style="">Composite</i>, and then in the <i style="">TableTree</i> constructor create a <i style="">Table</i> child. The resulting widget will
be 100% Java portable because you call the wrapped widget&#8217;s API.</p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;">Here are some
guidelines for wrapping SWT widgets:</p>

<p class="MsoNormal" style="margin-left: 43.5pt; text-indent: -0.25in;"><!--[if !supportLists]--><span style="font-family: Symbol;">·<span style="font-family: &quot;Times New Roman&quot;; font-style: normal; font-variant: normal; font-weight: normal; font-size: 7pt; line-height: normal; font-size-adjust: none; font-stretch: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><!--[endif]-->Forward as few methods and events as possible. Do not
fall into the trap of automatically reimplementing the complete API of the
wrapped widget. This will cause lots of boilerplate code and leave you playing
catch up when new API is added to the wrapped widget. If you find that you are
automatically forwarding every method, then it <i style="">might</i> make more sense to implement your code as an &#8216;adaptor&#8217; (i.e.
as a set of listeners that are added to the unwrapped widget when the widget is
created).</p>

<p class="MsoNormal" style="margin-left: 43.5pt; text-indent: -0.25in;"><!--[if !supportLists]--><span style="font-family: Symbol;">·<span style="font-family: &quot;Times New Roman&quot;; font-style: normal; font-variant: normal; font-weight: normal; font-size: 7pt; line-height: normal; font-size-adjust: none; font-stretch: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><!--[endif]-->Typically the methods you forward will be <b style="">setFont</b>, <b style="">setForeground</b>, <b style="">setBackground</b>,
<b style="">setCursor</b>,<b style=""> setEnabled</b>, <b style="">setMenu</b>,
and<b style=""> setToolTipText</b>. A typical
forwarding method calls super to set the value for the parent, and then sets
the value for the wrapped widget. You do not usually need to reimplement the
corresponding get methods &#8211; these return the value from the parent.</p>

<p class="MsoNormal" style="margin-left: 43.5pt; text-indent: -0.25in;"><!--[if !supportLists]--><span style="font-family: Symbol;">·<span style="font-family: &quot;Times New Roman&quot;; font-style: normal; font-variant: normal; font-weight: normal; font-size: 7pt; line-height: normal; font-size-adjust: none; font-stretch: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><!--[endif]-->Do not reimplement <b style="">setData</b>
or <b style="">getData</b> &#8211; your widget users can
use the data field in the parent.</p>

<p class="MsoNormal" style="margin-left: 43.5pt; text-indent: -0.25in;"><!--[if !supportLists]--><span style="font-family: Symbol;">·<span style="font-family: &quot;Times New Roman&quot;; font-style: normal; font-variant: normal; font-weight: normal; font-size: 7pt; line-height: normal; font-size-adjust: none; font-stretch: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><!--[endif]-->Consider exposing the wrapped widget &#8211; it does not
necessarily need to be hidden.</p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;">A complete example
of a <i style="">TableTree</i> widget that was
implemented by wrapping a <i style="">Table</i> is
provided in <a href="http://www.eclipse.org/articles/Article-Writing%20Your%20Own%20Widget/Writing%20Your%20Own%20Widget_files/AppendixA.htm">Appendix
A: TableTree and TableTreeItem</a>. This example also shows how <i style="">TableTreeItem</i> was implemented by
subclassing <i style="">Item</i> and wrapping a <i style="">TableItem</i>. Some of the design decisions
that were made are:</p>

<p class="MsoNormal" style="margin-left: 43.5pt; text-indent: -0.25in;"><!--[if !supportLists]--><span style="font-family: Symbol;">·<span style="font-family: &quot;Times New Roman&quot;; font-style: normal; font-variant: normal; font-weight: normal; font-size: 7pt; line-height: normal; font-size-adjust: none; font-stretch: normal;">&nbsp;&nbsp; </span></span><!--[endif]-->Wrap
a <i style="">Table</i> widget</p>

<p class="MsoNormal" style="margin-left: 43.5pt; text-indent: -0.25in;"><!--[if !supportLists]--><span style="font-family: Symbol;">·<span style="font-family: &quot;Times New Roman&quot;; font-style: normal; font-variant: normal; font-weight: normal; font-size: 7pt; line-height: normal; font-size-adjust: none; font-stretch: normal;">&nbsp;&nbsp; </span></span><!--[endif]-->Column
0 of the <i style="">Table</i> widget will contain
the &#8216;tree&#8217; representation</p>

<p class="MsoNormal" style="margin-left: 43.5pt; text-indent: -0.25in;"><!--[if !supportLists]--><span style="font-family: Symbol;">·<span style="font-family: &quot;Times New Roman&quot;; font-style: normal; font-variant: normal; font-weight: normal; font-size: 7pt; line-height: normal; font-size-adjust: none; font-stretch: normal;">&nbsp;&nbsp; </span></span><!--[endif]-->The
image in column 0 will contain a [+] or [-] to show the expanded state of the
tree</p>

<p class="MsoNormal" style="margin-left: 43.5pt; text-indent: -0.25in;"><!--[if !supportLists]--><span style="font-family: Symbol;">·<span style="font-family: &quot;Times New Roman&quot;; font-style: normal; font-variant: normal; font-weight: normal; font-size: 7pt; line-height: normal; font-size-adjust: none; font-stretch: normal;">&nbsp;&nbsp; </span></span><!--[endif]-->Because
we are using a <i style="">Table</i>, we need to use <i style="">TableColumn</i> and <i style="">TableItem</i> classes</p>

<p class="MsoNormal" style="margin-left: 43.5pt; text-indent: -0.25in;"><!--[if !supportLists]--><span style="font-family: Symbol;">·<span style="font-family: &quot;Times New Roman&quot;; font-style: normal; font-variant: normal; font-weight: normal; font-size: 7pt; line-height: normal; font-size-adjust: none; font-stretch: normal;">&nbsp;&nbsp; </span></span><!--[endif]-->Use <i style="">TableColumn</i> class directly &#8211; we do not
need to wrap it</p>

<p class="MsoNormal" style="margin-left: 43.5pt; text-indent: -0.25in;"><!--[if !supportLists]--><span style="font-family: Symbol;">·<span style="font-family: &quot;Times New Roman&quot;; font-style: normal; font-variant: normal; font-weight: normal; font-size: 7pt; line-height: normal; font-size-adjust: none; font-stretch: normal;">&nbsp;&nbsp; </span></span><!--[endif]-->Wrap <i style="">TableItem</i> to store the expanded state
and to enforce the column 0 restrictions</p>

<p class="MsoNormal" style="margin-left: 43.5pt; text-indent: -0.25in;"><!--[if !supportLists]--><span style="font-family: Symbol;">·<span style="font-family: &quot;Times New Roman&quot;; font-style: normal; font-variant: normal; font-weight: normal; font-size: 7pt; line-height: normal; font-size-adjust: none; font-stretch: normal;">&nbsp;&nbsp; </span></span><!--[endif]-->Implement
some of the <i style="">Tree</i> and <i style="">TreeItem</i> API methods that make sense for
<i style="">TableTree</i> and <i style="">TableTreeItem</i></p>

<p class="MsoNormal" style="margin-left: 43.5pt; text-indent: -0.25in;"><!--[if !supportLists]--><span style="font-family: Symbol;">·<span style="font-family: &quot;Times New Roman&quot;; font-style: normal; font-variant: normal; font-weight: normal; font-size: 7pt; line-height: normal; font-size-adjust: none; font-stretch: normal;">&nbsp;&nbsp; </span></span><!--[endif]-->Expose
the fact that we are wrapping a <i style="">Table</i>
by providing a <b style="">getTable()</b> method on <i style="">TableTree</i>. This simplifies our
implementation significantly because the user can create columns and show
headers and grid lines by going directly to the <i style="">Table</i>.</p>

<p class="MsoNormal" style="margin-left: 43.5pt; text-indent: -0.25in;"><!--[if !supportLists]--><span style="font-family: Symbol;">·<span style="font-family: &quot;Times New Roman&quot;; font-style: normal; font-variant: normal; font-weight: normal; font-size: 7pt; line-height: normal; font-size-adjust: none; font-stretch: normal;">&nbsp;&nbsp; </span></span><!--[endif]-->Reimplement
common API methods like <b style="">setFont</b> for
convenience</p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;">The following page
shows an example three-column <i style="">TableTree</i>,
and the application code that created it. The full source listing for <i style="">TableTree</i> and <i style="">TableTreeItem</i> is in <a href="http://www.eclipse.org/articles/Article-Writing%20Your%20Own%20Widget/Writing%20Your%20Own%20Widget_files/AppendixA.htm">Appendix A: TableTree
and TableTreeItem</a>.</p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if gte vml 1]><o:wrapblock><v:shape
  id="_x0000_s1027" type="#_x0000_t75" style='position:absolute;left:0;
  text-align:left;margin-left:0;margin-top:0;width:246pt;height:170.25pt;
  z-index:1;mso-position-horizontal-relative:text;
  mso-position-vertical-relative:text' o:allowincell="f">
  <v:imagedata src="./Writing%20Your%20Own%20Widget_files/image005.png"
   o:title=""/>
  <w:wrap type="topAndBottom" anchorx="page"/>
 </v:shape><![endif]--><!--[if !vml]--><img src="Writing%20Your%20Own%20Widget_files/image006.jpg" v:shapes="_x0000_s1027" height="227" width="328"><!--[endif]--><!--[if gte vml 1]></o:wrapblock><![endif]--><br style="" clear="all">
<!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<br style="" clear="all">

<p class="MsoNormal" style="margin-left: 25.5pt;"><b style="">A TableTree in a Shell<o:p></o:p></b></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">public</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">static</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">void</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
main(String [] args) {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>Shell shell = </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">new</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
Shell();<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>Image image = </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">new</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
Image(</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">null</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">, 20, 20);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>Color red = </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">new</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
Color(</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">null</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">, 255, 0, 0);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>GC gc = </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">new</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> GC(image);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>gc.setBackground(red);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>gc.fillRectangle(image.getBounds());<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>gc.dispose();<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>red.dispose();<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>TableTree tableTree = </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">new</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
TableTree(shell, SWT.BORDER);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>tableTree.setSize(320, 200);</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: maroon;"><o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>Table table = tableTree.getTable();<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>table.setHeaderVisible(</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">true</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>table.setLinesVisible(</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">true</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">for</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> (</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">int</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> col = 0; col &lt; 3; col++) {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>TableColumn column = </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">new</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> TableColumn(table,
SWT.NONE, col);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>column.setText(</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: teal;">"Column
"</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> + col);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>column.setWidth(100);</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: maroon;"><o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">for</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> (</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">int</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> iRoot = 0; iRoot &lt; 8; iRoot++) {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>TableTreeItem root = </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">new</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
TableTreeItem(tableTree, SWT.NONE);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>root.setText(</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: teal;">"Root "</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> +
iRoot);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">for</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> (</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">int</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> iBranch = 0; iBranch &lt; 4; iBranch++) {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>TableTreeItem branch = </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">new</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
TableTreeItem(root, SWT.NONE);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>branch.setText(</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: teal;">"Branch
"</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> + iBranch);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">for</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> (</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">int</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> col = 1; col &lt; 3; col++) {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>branch.setImage(col, image);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>branch.setText(col, </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: teal;">"R"</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">+iRoot+</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: teal;">"B"</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">+iBranch+</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: teal;">"C"</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">+col);</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: teal;"><o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">for</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> (</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">int</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> iLeaf = 0; iLeaf &lt; 4; iLeaf++) {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>TableTreeItem leaf = </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">new</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
TableTreeItem(branch, SWT.NONE);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>leaf.setText(</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: teal;">"Leaf
"</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> + iLeaf);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">for</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> (</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">int</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> col = 1; col &lt; 3; col++) {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>leaf.setImage(col, image);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>leaf.setText(col, </span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: teal;">"R"</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">+iRoot+</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: teal;">"B"</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">+iBranch+</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: teal;">"L"</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">+iLeaf+</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: teal;">C"</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">+col);<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>shell.pack(); shell.open();<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>Display display = shell.getDisplay();<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">while</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> (!shell.isDisposed()) {<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">if</span><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> (!display.readAndDispatch())
display.sleep();<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">}<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<h3 style="margin-left: 25.5pt;"><a name="_Toc506634635"></a><a name="_Toc496069428"></a><a name="_Toc496069785"><span style=""><span style="">Subclassing Widgets
Directly</span></span></a></h3>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style="">In extreme
circumstances, you may need to subclass a widget other than <i style="">Canvas</i> or <i style="">Composite</i>. We recommend against doing this unless all other avenues
have been explored and exhausted. Try to wrap the widget first, before
subclassing it. Here is why:</span></span></p>

<p class="MsoNormal" style="margin-left: 43.5pt; text-indent: -0.25in;"><span style=""><span style=""><!--[if !supportLists]--><span style="font-family: Symbol;">·<span style="font-family: &quot;Times New Roman&quot;; font-style: normal; font-variant: normal; font-weight: normal; font-size: 7pt; line-height: normal; font-size-adjust: none; font-stretch: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><!--[endif]-->Subclasses may inherit a lot of API that makes no
sense, and must be overridden. In Java, you cannot override a method and change
the return type; therefore you cannot reimplement some methods.</span></span></p>

<p class="MsoNormal" style="margin-left: 43.5pt; text-indent: -0.25in;"><span style=""><span style=""><!--[if !supportLists]--><span style="font-family: Symbol;">·<span style="font-family: &quot;Times New Roman&quot;; font-style: normal; font-variant: normal; font-weight: normal; font-size: 7pt; line-height: normal; font-size-adjust: none; font-stretch: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><!--[endif]-->Subclassing is typically not the safest way to extend a
class that you do not own. For a simplified list of the common arguments, see
the article by <strong><span style="font-weight: normal;">Bill Venners </span></strong>in
the Nov '98 issue of <i style="">Java World</i>
called <i style="">&#8220;Inheritance versus composition:
Which one should you choose?&#8221;</i> at: </span></span><a href="http://www.javaworld.com/javaworld/jw-11-1998/jw-11-techniques.html"><span style=""><span style="">http://www.javaworld.com/javaworld/jw-11-1998/jw-11-techniques.html</span></span><span style=""><span style=""></span></span></a><span style=""><span style=""></span></span></p>

<p class="MsoNormal" style="margin-left: 43.5pt; text-indent: -0.25in;"><span style=""><span style=""><!--[if !supportLists]--><span style="font-family: Symbol;">·<span style="font-family: &quot;Times New Roman&quot;; font-style: normal; font-variant: normal; font-weight: normal; font-size: 7pt; line-height: normal; font-size-adjust: none; font-stretch: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><!--[endif]-->Widget subclasses are almost certainly guaranteed to be
platform-specific unless great care is taken to ensure that they work on all
platforms.</span></span></p>

<p class="MsoNormal" style="margin-left: 43.5pt; text-indent: -0.25in;"><span style=""><span style=""><!--[if !supportLists]--><span style="font-family: Symbol;">·<span style="font-family: &quot;Times New Roman&quot;; font-style: normal; font-variant: normal; font-weight: normal; font-size: 7pt; line-height: normal; font-size-adjust: none; font-stretch: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><!--[endif]-->Subclassed widgets can be affected by changes in the
non-API implementation of the superclass.</span></span></p>

<p class="MsoNormal" style="margin-left: 43.5pt; text-indent: -0.25in;"><span style=""><span style=""><!--[if !supportLists]--><span style="font-family: Symbol;">·<span style="font-family: &quot;Times New Roman&quot;; font-style: normal; font-variant: normal; font-weight: normal; font-size: 7pt; line-height: normal; font-size-adjust: none; font-stretch: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><!--[endif]-->Subclassing may cause bad system-level bugs, and runs
the risk of leaking resources. For example, if a subclass reimplements a method
without making certain that dispose code from the superclass method is still
called, then the new method will leak system resources.</span></span></p>

<p class="MsoNormal" style="margin-left: 43.5pt; text-indent: -0.25in;"><span style=""><span style=""><!--[if !supportLists]--><span style="font-family: Symbol;">·<span style="font-family: &quot;Times New Roman&quot;; font-style: normal; font-variant: normal; font-weight: normal; font-size: 7pt; line-height: normal; font-size-adjust: none; font-stretch: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><!--[endif]-->Binary incompatibility across releases becomes
possible. If a method signature or field name changes, or new methods or fields
are added, there may be a name conflict in the widget subclass. Only <i style="">Canvas</i> and <i style="">Composite </i>are guaranteed not to have name conflicts in future
releases.</span></span></p>

<p class="MsoNormal" style="margin-left: 43.5pt; text-indent: -0.25in;"><span style=""><span style=""><!--[if !supportLists]--><span style="font-family: Symbol;">·<span style="font-family: &quot;Times New Roman&quot;; font-style: normal; font-variant: normal; font-weight: normal; font-size: 7pt; line-height: normal; font-size-adjust: none; font-stretch: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><!--[endif]-->See any paper by Leonid <span style="color: black;">Mikhajlov
on the <i style="">&#8220;Fragile Base Class Problem&#8221;</i>.
He has a summary of this problem on his web page at: </span></span></span><a href="http://www.abo.fi/%7Elmikhajl/"><span style=""><span style="">http://www.abo.fi/~lmikhajl/</span></span><span style=""><span style=""></span></span></a><span style=""><span style=""></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style="">Consider the example of <i style="">TableTree</i>. We chose to wrap <i style="">Table</i>
rather than subclass it. The best test is to ask whether a <i style="">TableTree</i> &#8216;is-a&#8217; <i style="">Table</i>.
The answer is definitely not &#8211; we have simply chosen to implement <i style="">TableTree</i> using <i style="">Table</i>. We cannot talk about the &#8216;rows&#8217; of a <i style="">TableTree</i>, or index into a <i style="">TableTree</i>;
and the first column of the <i style="">Table</i> is
reserved for the &#8216;tree&#8217;. Many of the operations for a <i style="">Table</i> do not make sense for a <i style="">TableTree</i>,
for example <b style="">getSelectionIndex()</b> and <b style="">getTopIndex()</b>.</span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style="">Subclassing <i style="">Canvas</i> or <i style="">Composite</i> is
the best way to ensure that your widget works on all SWT platforms. The &#8216;is-a&#8217;
test in this case tests whether your widget is-a basic or compound widget.
Subclassing anything else requires asking if the new widget<b style=""> is-an SWT native widget of the type being subclassed</b>. For example,
a 100% Java portable <i style="">PictureLabel</i> is
not an SWT native <i style="">Label</i>.</span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style="">When subclassing anything other than <i style="">Composite</i> or <i style="">Canvas</i> you must override the method <b style="">protected void checkSubclass()</b> to do nothing. Make sure you read
the method comment before overriding it.</span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style=""><b style=""><span style="font-size: 14pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></b></span></span></p>

<h3 style="margin-left: 25.5pt;"><span style=""><span style=""><a name="_Toc506634636">Wrapping a Native
Widget</a></span></span></h3>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style="">Sometimes, an application requires a native
widget that is not provided by SWT. This may be a platform widget, or a third
party widget, or any other widget in a shared library. In this section, we will
describe how to interface to a native widget on the Windows and Motif
platforms. This section assumes that you have some understanding of the <i style="">Java Native Interface</i>, or <b style="">JNI</b>. Two good books on JNI are:</span></span></p>

<p class="MsoNormal" style="margin-left: 43.5pt; text-indent: -0.25in;"><span style=""><span style=""><!--[if !supportLists]--><span style="font-family: Symbol;">·<span style="font-family: &quot;Times New Roman&quot;; font-style: normal; font-variant: normal; font-weight: normal; font-size: 7pt; line-height: normal; font-size-adjust: none; font-stretch: normal;">&nbsp;&nbsp; </span></span><!--[endif]--><i style="">&#8220;The Java Native Interface, Programmer&#8217;s
Guide and Specification&#8221;</i> by Sheng Liang</span></span></p>

<p class="MsoNormal" style="margin-left: 43.5pt; text-indent: -0.25in;"><span style=""><span style=""><!--[if !supportLists]--><span style="font-family: Symbol;">·<span style="font-family: &quot;Times New Roman&quot;; font-style: normal; font-variant: normal; font-weight: normal; font-size: 7pt; line-height: normal; font-size-adjust: none; font-stretch: normal;">&nbsp;&nbsp; </span></span><!--[endif]--><i style="">&#8220;Essential JNI, Java Native Interface&#8221;</i>
by Rob Gordon</span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style="">This section also assumes that you have done
some platform programming before, and are proficient in C and in the use of
makefiles. You must have platform documentation available, such as the MSDN
Library on Windows, and Motif 2.1 documentation or &#8216;man pages&#8217; for your Motif
Unix/Linux system. If you are programming to a third party widget, you will
need to know its API.</span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style="">In this section, we will create a shared
library and load it using:</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>System.loadLibrary(<span style="color: teal;">"mywidget"</span>);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style="">On Windows, this loads a Dynamic Link
Library or DLL file called &#8220;mywidget.dll&#8221;.</span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style="">On Motif, this loads a Shared Object Library
or SO file called &#8220;libmywidget.so&#8221;.</span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style="">For our example, we will be building a
widget we will call <i style="">Spinner</i>. On
Windows, the native widget we will use is called an <i style="">UpDown</i> control, and on Motif we will be using an <i style="">XmSimpleSpinBox</i>. They look like this:</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if gte vml 1]><o:wrapblock><v:shape
  id="_x0000_s1032" type="#_x0000_t75" style='position:absolute;left:0;
  text-align:left;margin-left:59.55pt;margin-top:0;width:134.25pt;height:44.25pt;
  z-index:2;mso-position-horizontal:absolute;
  mso-position-horizontal-relative:text;mso-position-vertical:top;
  mso-position-vertical-relative:text'>
  <v:imagedata src="./Writing%20Your%20Own%20Widget_files/image007.png"
   o:title=""/>
  <w:wrap type="topAndBottom" anchorx="page"/>
 </v:shape><![if gte mso 9]><o:OLEObject Type="Embed" ProgID="PBrush"
  ShapeID="_x0000_s1032" DrawAspect="Content" ObjectID="_1053168692">
 </o:OLEObject>
 <![endif]><![endif]--><!--[if !vml]--><span style="">
 <table align="left" cellpadding="0" cellspacing="0">
  <tbody><tr>
   <td height="0" width="79"></td>
  </tr>
  <tr>
   <td></td>
   <td><img src="Writing%20Your%20Own%20Widget_files/image008.jpg" v:shapes="_x0000_s1032" height="59" width="179"></td>
  </tr>
 </tbody></table>
 </span><!--[endif]--><!--[if gte vml 1]></o:wrapblock><![endif]--><br style="" clear="all">
<span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p><p></p>

<br style="" clear="all">

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style="">Our <i style="">Spinner</i>
will be numeric, and we want to be able to set and get the maximum and minimum
value, as well as the current value (which we will call the &#8216;selection&#8217;, to
conform to SWT convention). We also want to be able to set the font. When the
user clicks on one of the arrows, we want to notify listeners that the
selection has changed, so we will need to implement a selection listener. The
test code for our widget looks something like this (the full source listing for
class <i style="">SpinnerTest</i> is in </span></span><a href="http://www.eclipse.org/articles/Article-Writing%20Your%20Own%20Widget/Writing%20Your%20Own%20Widget_files/AppendixB.htm"><span style=""><span style="">Appendix
B: SpinnerTest and Spinner</span></span><span style=""><span style=""></span></span></a><span style=""><span style="">):</span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span></span></span></span><span style=""><span style=""><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">final</span></span></span><span style=""><span style=""><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
Spinner spinner = </span></span></span><span style=""><span style=""><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">new</span></span></span><span style=""><span style=""><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
Spinner(shell, 0);<o:p></o:p></span></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>spinner.setMaximum(999);<o:p></o:p></span></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>spinner.setSelection(500);<o:p></o:p></span></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>spinner.setMinimum(100);<o:p></o:p></span></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>Font
font = </span></span></span><span style=""><span style=""><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">new</span></span></span><span style=""><span style=""><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
Font(display, </span></span></span><span style=""><span style=""><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: teal;">"Courier"</span></span></span><span style=""><span style=""><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">, 20,
SWT.NORMAL);<o:p></o:p></span></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>spinner.setFont(font);<o:p></o:p></span></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>spinner.addSelectionListener(</span></span></span><span style=""><span style=""><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">new</span></span></span><span style=""><span style=""><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
SelectionAdapter() {<o:p></o:p></span></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span></span><span style=""><span style=""><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">public</span></span></span><span style=""><span style=""><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"> </span></span></span><span style=""><span style=""><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: navy;">void</span></span></span><span style=""><span style=""><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;">
widgetSelected(SelectionEvent e) {<o:p></o:p></span></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>System.out.println(spinner.getSelection());<o:p></o:p></span></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}<o:p></o:p></span></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><span style="">&nbsp; </span>});<o:p></o:p></span></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style="">The next step is to write the API in Java. Since
we know we will be writing the native interface file (we&#8217;ll call it
&#8220;spinner.c&#8221;) twice &#8211; once on Windows and once on Motif &#8211; we try to write the
Java code only once so that it is easier to maintain. We start by creating a
subclass of <i style="">Composite</i>, and we load
the shared library in a static initializer:</span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="color: black;"><span style="">&nbsp; </span></span>static<span style="color: black;"> {<o:p></o:p></span></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>System.loadLibrary(</span><span style="color: teal;">"spinner"</span><span style="color: black;">);<span style=""> </span><o:p></o:p></span></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="color: black;"><span style="">&nbsp; </span>}<o:p></o:p></span></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style="">This will load a file called &#8220;spinner.dll&#8221;
on Windows, and &#8220;libspinner.so&#8221; on Motif. Since we know that creating a widget
returns a &#8216;handle&#8217; on both platforms, we define an instance variable to hold
the handle:</span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span><span style="color: navy;">int</span> handleSpinner;</span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="font-size: 9pt; font-family: &quot;Courier New&quot;; color: black;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style="">Since we will be providing a listener, we
know that we will need to map this handle back to the Java <i style="">Spinner</i> object when the platform calls in to Java to notify us of
the event. So we create a static <i style="">Hashtable</i>
that will contain <i style="">Spinner</i> handles as
keys and <i style="">Spinner</i> objects as values: </span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span><span style="color: navy;">static</span> Hashtable table = <span style="color: navy;">new</span>
Hashtable();</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style="">Now we write the constructor. We add the
handle to the table after the widget is created, and we remove it when the
widget is destroyed. Note that we don&#8217;t create the widget in Java. We will
create it later, in the native <b style="">createControl</b>
method. We also forward all <b style="">controlResized</b>
and <b style="">focusGained</b> events to the native
<b style="">resizeControl</b> and <b style="">setFocus</b> methods, and set our font to
the default font using the native <b style="">setFont</b>
method. There is one more thing to explain in the constructor. You may notice
that we are actually creating two widgets: a <i style="">Composite</i> parent named <b style="">handle</b>
in the call to super, and a <i style="">Spinner</i>
child named <b style="">handleSpinner</b> in the
call to <b style="">createControl</b>. This wraps
the native control in an SWT parent, allowing it to participate in the SWT
system.</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span><span style="color: navy;">public</span> Spinner(Composite parent, <span style="color: navy;">int</span> style) {</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: navy;">super</span>(parent, style);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: navy;">int</span> handleParent = handle;</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span><span style="">&nbsp;&nbsp; </span>handleSpinner = createControl(handleParent);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: navy;">if</span> (handleSpinner == 0)
SWT.error(SWT.ERROR_NO_HANDLES);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>table.put(<span style="color: navy;">new</span> Integer(handleSpinner), <span style="color: navy;">this</span>);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>addDisposeListener(<span style="color: navy;">new</span> DisposeListener() {</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: navy;">public</span> <span style="color: navy;">void</span>
widgetDisposed(DisposeEvent e) {</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Spinner.<span style="color: navy;">this</span>.widgetDisposed(e);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>});</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>addControlListener(<span style="color: navy;">new</span> ControlAdapter() {</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: navy;">public</span> <span style="color: navy;">void</span>
controlResized(ControlEvent e) {</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Spinner.<span style="color: navy;">this</span>.controlResized(e);<span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>});</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>addFocusListener(<span style="color: navy;">new</span> FocusAdapter() {</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: navy;">public</span> <span style="color: navy;">void</span>
focusGained(FocusEvent e) {</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Spinner.<span style="color: navy;">this</span>.focusGained(e);<span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>});</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>Font
font = getFont();</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>setFont(handleSpinner,
font.handle);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>}</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span><span style="color: navy;">public</span><span style="color: black;"> </span><span style="color: navy;">void</span><span style="color: black;">
widgetDisposed(DisposeEvent e) {<o:p></o:p></span></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>table.remove(</span><span style="color: navy;">new</span> Integer(handleSpinner)<span style="color: black;">);<o:p></o:p></span></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>handleSpinner = 0;<o:p></o:p></span></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="color: black;"><span style="">&nbsp; </span>}<o:p></o:p></span></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="color: black;"><span style="">&nbsp; </span><o:p></o:p></span></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="color: black;"><span style="">&nbsp; </span></span><span style="color: navy;">public</span><span style="color: black;"> </span><span style="color: navy;">void</span><span style="color: black;"> controlResized(ControlEvent e) {<o:p></o:p></span></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>Rectangle rect = getClientArea();<o:p></o:p></span></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="color: black;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>resizeControl(handleSpinner, rect.x,
rect.y, rect.width, rect.height);<span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><o:p></o:p></span></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="color: black;"><span style="">&nbsp; </span>}<o:p></o:p></span></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span><span style="color: navy;">public</span> <span style="color: navy;">void</span>
focusGained(FocusEvent e) {</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>setFocus(handleSpinner);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>}</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="color: navy;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="color: navy;"><span style="">&nbsp; </span>static</span> <span style="color: navy;">final</span>
<span style="color: navy;">native</span> <span style="color: navy;">int</span> createControl(<span style="color: navy;">int</span> handleParent);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span><span style="color: navy;">static</span> <span style="color: navy;">final</span> <span style="color: navy;">native</span> <span style="color: navy;">void</span>
resizeControl(<span style="color: navy;">int</span> handle, <span style="color: navy;">int</span> x, <span style="color: navy;">int</span> y, <span style="color: navy;">int</span> width, <span style="color: navy;">int</span>
height);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span><span style="color: navy;">static</span> <span style="color: navy;">final</span> <span style="color: navy;">native</span> <span style="color: navy;">void</span> setFocus(<span style="color: navy;">int</span> handle);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style="">We write the <b style="">setFont</b> API method to call the native <b style="">setFont</b> method with the <i style="">Spinner</i>
handle and the font handle. Call <b style="">super.setFont</b>
because some superclasses need to set fonts for things like titles &#8211; it will
not actually be needed in this case, but by convention widgets usually inform
their superclass of font and color changes.</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span><span style="color: navy;">public</span> <span style="color: navy;">void</span>
setFont(Font font) {</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: navy;">super</span>.setFont(font);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: navy;">int</span> hFont = 0;</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: navy;">if</span> (font != <span style="color: navy;">null</span>)
hFont = font.handle;</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>setFont(handleSpinner,
hFont);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>}</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span><span style="color: navy;">static</span> <span style="color: navy;">final</span> <span style="color: navy;">native</span> <span style="color: navy;">void</span> setFont(<span style="color: navy;">int</span> handle, <span style="color: navy;">int</span>
hFont);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style="">In a similar manner, we write the remaining
set and get API methods and declare the corresponding native methods. The <b style="">checkWidget</b> method simply checks that
the widget is still valid.</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span><span style="color: navy;">public</span> <span style="color: navy;">void</span>
setSelection(<span style="color: navy;">int</span> selection) {</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>checkWidget();</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>setPosition(handleSpinner,
selection);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>}</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span><span style="color: navy;">public</span> <span style="color: navy;">int</span> getSelection()
{</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>checkWidget();</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: navy;">return</span> getPosition(handleSpinner);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>}</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span><span style="color: navy;">public</span> <span style="color: navy;">void</span>
setMaximum(<span style="color: navy;">int</span> maximum) {</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>checkWidget();</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>setMaximum(handleSpinner,
maximum);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>}</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span><span style="color: navy;">public</span> <span style="color: navy;">int</span>
getMaximum() {</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>checkWidget();</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: navy;">return</span> getMaximum(handleSpinner);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>}</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span><span style="color: navy;">public</span> <span style="color: navy;">void</span>
setMinimum(<span style="color: navy;">int</span> minimum) {</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>checkWidget();</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>setMinimum(handleSpinner,
minimum);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>}</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span><span style="color: navy;">public</span> <span style="color: navy;">int</span>
getMinimum() {</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>checkWidget();</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: navy;">return</span> getMinimum(handleSpinner);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>}</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span><span style="color: navy;">static</span> <span style="color: navy;">final</span> <span style="color: navy;">native</span> <span style="color: navy;">void</span>
setPosition(<span style="color: navy;">int</span> handle, <span style="color: navy;">int</span> position);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span><span style="color: navy;">static</span> <span style="color: navy;">final</span> <span style="color: navy;">native</span> <span style="color: navy;">int</span>
getPosition(<span style="color: navy;">int</span> handle);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span><span style="color: navy;">static</span> <span style="color: navy;">final</span> <span style="color: navy;">native</span> <span style="color: navy;">void</span>
setMaximum(<span style="color: navy;">int</span> handle, <span style="color: navy;">int</span>
max);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span><span style="color: navy;">static</span> <span style="color: navy;">final</span> <span style="color: navy;">native</span> <span style="color: navy;">int</span>
getMaximum(<span style="color: navy;">int</span> handle);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span><span style="color: navy;">static</span> <span style="color: navy;">final</span> <span style="color: navy;">native</span> <span style="color: navy;">void</span>
setMinimum(<span style="color: navy;">int</span> handle, <span style="color: navy;">int</span>
min);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span><span style="color: navy;">static</span> <span style="color: navy;">final</span> <span style="color: navy;">native</span> <span style="color: navy;">int</span>
getMinimum(<span style="color: navy;">int</span> handle);</span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style="">As with all widgets we implement, we need to
provide a <b style="">computeSize</b> method to
compute the preferred size of the widget. This one also forwards to a native to
do the work. In this case, the native needs to return two integers (width and
height) so we use an int array of size 2 to hold the returned values:</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span><span style="color: navy;">public</span> Point computeSize(<span style="color: navy;">int</span>
wHint, <span style="color: navy;">int</span> hHint, <span style="color: navy;">boolean</span>
changed) {</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>checkWidget();</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: navy;">int</span> [] result = <span style="color: navy;">new</span> <span style="color: navy;">int</span> [2];</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>computeSize(handleSpinner,
result);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: navy;">if</span> (wHint != SWT.DEFAULT) result [0] = wHint;</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: navy;">if</span> (hHint != SWT.DEFAULT) result [1] = hHint;</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: navy;">int</span> border = getBorderWidth();</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: navy;">return</span> <span style="color: navy;">new</span>
Point(result [0] + border * 2, result [1] + border * 2);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>}</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span><span style="color: navy;">static</span> <span style="color: navy;">final</span> <span style="color: navy;">native</span> <span style="color: navy;">void</span>
computeSize(<span style="color: navy;">int</span> handle, <span style="color: navy;">int</span> [] result);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style="">Finally, we need to define the listener
interface. The <b style="">addSelectionListener</b>
method simply adds an <b style="">SWT.Selection</b>
listener using the SWT low-level listener mechanism. The <b style="">widgetSelected</b> method is special. It is the entry point into Java
when the event occurs. In other words, we will be calling this method from C.
When the method is called, it determines the <i style="">Spinner</i> for the event by looking in the table, and then forwards to
the SWT event mechanism by calling <b style="">notifyListeners</b>.</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span><span style="color: navy;">public</span> <span style="color: navy;">void</span>
addSelectionListener(SelectionListener listener) {</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: navy;">if</span> (listener == <span style="color: navy;">null</span>)
<span style="color: navy;">throw</span> <span style="color: navy;">new</span>
SWTError(SWT.ERROR_NULL_ARGUMENT);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>addListener(SWT.Selection,
<span style="color: navy;">new</span> TypedListener(listener));</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>}</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span><span style="color: navy;">static</span> <span style="color: navy;">void</span>
widgetSelected(<span style="color: navy;">int</span> handle) {</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>Spinner
spinner = (Spinner) table.get(<span style="color: navy;">new</span>
Integer(handle));</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: navy;">if</span> (spinner == <span style="color: navy;">null</span>) <span style="color: navy;">return</span>;</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>spinner.notifyListeners(SWT.Selection,
<span style="color: navy;">new</span> Event());</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>}</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style="">Notice that the <i style="">Event</i> object that we create for the <i style="">Spinner</i> selection listener does not need to have any fields set. If
you need to return more information for your event, such as the x and y
coordinates of the event or the key that was pressed, then your call-in method
(<b style="">widgetSelected</b>, in this case) will
have to have more parameters than just the handle.</span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style="">One more thing to note before we write the C
code. All of our native methods have been defined as static methods, and all of
them have the handle passed as the first parameter. This consistency makes it
easier to write the C native code.</span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style="">The full source code listing for the Java <i style="">Spinner</i> class is in in </span></span><a href="http://www.eclipse.org/articles/Article-Writing%20Your%20Own%20Widget/Writing%20Your%20Own%20Widget_files/AppendixB.htm"><span style=""><span style="">Appendix
B: SpinnerTest and Spinner</span></span><span style=""><span style=""></span></span></a><span style=""><span style="">. Now we need to write
the native interface methods in C. First we will write the native interface for
Windows, and then we will write it for Motif.</span></span></p>

<h3 style="margin-left: 25.5pt;"><span style=""><span style=""><a name="_Toc506634637">Windows Native Code</a></span></span></h3>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style="">Now we really get into JNI and platform
programming. We will write a C file called &#8220;spinner.c&#8221;. It needs to implement
the following Java methods from class spinner.<i style="">Spinner</i>:</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span><span style="color: navy;">static</span> <span style="color: navy;">final</span> <span style="color: navy;">native</span> <span style="color: navy;">int</span>
createControl(<span style="color: navy;">int</span> handleParent);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span><span style="color: navy;">static</span> <span style="color: navy;">final</span> <span style="color: navy;">native</span> <span style="color: navy;">void</span>
computeSize(<span style="color: navy;">int</span> handle, <span style="color: navy;">int</span> [] result);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span><span style="color: navy;">static</span> <span style="color: navy;">final</span> <span style="color: navy;">native</span> <span style="color: navy;">void</span>
resizeControl(<span style="color: navy;">int</span> handle, <span style="color: navy;">int</span> x, <span style="color: navy;">int</span> y, <span style="color: navy;">int</span> width, <span style="color: navy;">int</span>
height);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span><span style="color: navy;">static</span> <span style="color: navy;">final</span> <span style="color: navy;">native</span> <span style="color: navy;">void</span>
setPosition(<span style="color: navy;">int</span> handle, <span style="color: navy;">int</span> position);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span><span style="color: navy;">static</span> <span style="color: navy;">final</span> <span style="color: navy;">native</span> <span style="color: navy;">int</span>
getPosition(<span style="color: navy;">int</span> handle);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span><span style="color: navy;">static</span> <span style="color: navy;">final</span> <span style="color: navy;">native</span> <span style="color: navy;">void</span>
setMaximum(<span style="color: navy;">int</span> handle, <span style="color: navy;">int</span>
max);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span><span style="color: navy;">static</span> <span style="color: navy;">final</span> <span style="color: navy;">native</span> <span style="color: navy;">int</span>
getMaximum(<span style="color: navy;">int</span> handle);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span><span style="color: navy;">static</span> <span style="color: navy;">final</span> <span style="color: navy;">native</span> <span style="color: navy;">void</span>
setMinimum(<span style="color: navy;">int</span> handle, <span style="color: navy;">int</span>
min);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span><span style="color: navy;">static</span> <span style="color: navy;">final</span> <span style="color: navy;">native</span> <span style="color: navy;">int</span>
getMinimum(<span style="color: navy;">int</span> handle);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span><span style="color: navy;">static</span> <span style="color: navy;">final</span> <span style="color: navy;">native</span> <span style="color: navy;">void</span> setFont(<span style="color: navy;">int</span> handle, <span style="color: navy;">int</span>
hFont);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span><span style="color: navy;">static</span> <span style="color: navy;">final</span> <span style="color: navy;">native</span> <span style="color: navy;">void</span> setFocus(<span style="color: navy;">int</span> handle);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style="">It also needs to call in to the following
Java method when the selection changes:</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span><span style="color: navy;">static</span> <span style="color: navy;">void</span>
widgetSelected(<span style="color: navy;">int</span> handle);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style="">The first thing we need to do is to include
at least these three files. Your control may require additional files.</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style="">#include &lt;jni.h&gt;</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style="">#include &lt;windows.h&gt;</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style="">#include &lt;commctrl.h&gt;</span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style="">We will start with the <b style="">createControl</b> method. Recall that we decided to use a Windows <i style="">UpDown</i> control. If we create an <i style="">Edit</i> control first, and then create the <i style="">UpDown</i> control with </span></span><span style=""><span style=""><span style="font-size: 11pt;">UDS_AUTOBUDDY
</span><span style="">and</span></span></span><span style=""><span style=""><span style="font-size: 11pt;">
UDS_SETBUDDYINT</span><span style=""> flags set, then the <i style="">Edit</i> control will automatically be
associated with the <i style="">UpDown</i> control&#8217;s
arrows. We can retrieve the <i style="">Edit</i> control
by sending </span></span></span><span style=""><span style=""><span style="font-size: 11pt;">UDM_GETBUDDY</span><span style=""> to the <i style="">UpDown </i>control. We will
show you the complete <b style="">createControl</b>
method after we explain how to call in to Java.<o:p></o:p></span></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style=""><b style=""><span style="">Calling in to Java:<o:p></o:p></span></b></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style="">The first time we ever call <b style="">createControl</b>, we initialize some
static variables:</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style="">static DWORD tlsIndex = 0;</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style="">static jobject javaClass;</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style="">static jmethodID mid;</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style="">static WNDPROC oldProc;</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style="">We use one of them (<b style="">tlsIndex</b>) as a flag to make sure we initialize them only once. Here
is the initialization code from <b style="">createControl</b>:</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>if
(tlsIndex == 0) {</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>tlsIndex
= TlsAlloc();</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>if
(tlsIndex == -1) return (jint) 0;</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>javaClass
= (*env)-&gt;NewGlobalRef(env, (jobject) that);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>mid
= (*env)-&gt;GetStaticMethodID(env, (jobject) that, "widgetSelected",
"(I)V");</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>oldProc
= (WNDPROC) GetWindowLong((HWND) hwndParent, GWL_WNDPROC);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>}</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>TlsSetValue(tlsIndex,
(LPVOID) env);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style="">These variables are needed to implement
call-in. As this is important code, we will describe each variable that is
initialized:</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>tlsIndex
= TlsAlloc();</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>if
(tlsIndex == -1) return (jint) 0;</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>&#8230;</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>}</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>TlsSetValue(tlsIndex,
(LPVOID) env);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style="">Here, we allocate a Windows <i style="">Thread Local Storage</i> (TLS) index, and
then (for each <i style="">Spinner</i>) we use the
TLS index to store a pointer called <b style="">env</b>.
Notice that <b style="">JNIEnv *env</b> is the first
parameter passed to every JNI method. It is a pointer to a function table, and
it is only valid in the thread associated with it. We know that we need to call
in to Java when the user changes the <i style="">Spinner</i>
value, and that we will be calling in from a Windows &#8216;window procedure&#8217; or </span></span><span style=""><span style=""><span style="font-size: 11pt;">WNDPROC</span>. The </span></span><span style=""><span style=""><span style="font-size: 11pt;">WNDPROC</span> does not know
about the Java environment. When the </span></span><span style=""><span style=""><span style="font-size: 11pt;">WNDPROC</span> is invoked, we will need
&#8216;env&#8217;. So we have to save it on creation so that we have it when we need to
call in. We also need the class and method ID to call in to, and we can store
these in statics because they will be the same across all threads:</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>javaClass
= (*env)-&gt;NewGlobalRef(env, (jobject) that);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>mid
= (*env)-&gt;GetStaticMethodID(env, (jobject) that, "widgetSelected",
"(I)V");</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style="">When the user changes the <i style="">Spinner</i> value, the <i style="">UpDown</i> sends a </span></span><span style=""><span style=""><span style="font-size: 11pt;">WM_VSCROLL</span> to its parent control.<span style="">&nbsp; </span>In order to see this message, it is necessary to &#8220;subclass the
window proc&#8221; of the parent.<span style="">&nbsp; </span>In Windows,
this means replacing the window proc of the parent with our own window
proc.<span style="">&nbsp; </span>The new </span></span><span style=""><span style=""><span style="font-size: 11pt;">WNDPROC</span> will look for
</span></span><span style=""><span style=""><span style="font-size: 11pt;">WM_VSCROLL</span>
(in order to notify the Java code that the <i style="">Spinner</i>
value has been changed) and then call the previous </span></span><span style=""><span style=""><span style="font-size: 11pt;">WNDPROC</span> to handle
other messages that our control is not interested in.<span style="">&nbsp; </span>Note that it is important to call the previous </span></span><span style=""><span style=""><span style="font-size: 11pt;">WNDPROC</span>, or the
parent window will not behave properly (i.e. it will not paint or resize, etc.)
We store the previous </span></span><span style=""><span style=""><span style="font-size: 11pt;">WNDPROC</span> in oldProc:</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>oldProc
= (WNDPROC) GetWindowLong((HWND) hwndParent, GWL_WNDPROC);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style="">The last line in <b style="">createControl</b> before we return the new handle installs a </span></span><span style=""><span style=""><span style="font-size: 11pt;">WNDPROC</span> called <b style="">WindowProc</b>:</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>SetWindowLong((HWND)
hwndParent, GWL_WNDPROC, (long) WindowProc);</span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style="">Here is the code for our <b style="">WindowProc</b>. First we retrieve <b style="">env</b> from Thread Local Storage and check
if an exception has occurred. Then we see if this is an &#8220;<i style="">UpDown</i> value changed&#8221; event (a </span></span><span style=""><span style=""><span style="font-size: 11pt;">WM_VSCROLL<span style=""> message with SB_THUMBPOSITION</span></span> in
the low order bits of <b style="">wParam</b>). If it
is, we use <b style="">env</b> to call in to the
Java static method called &#8220;widgetSelected&#8221;, passing <b style="">lParam</b> as the handle of the <i style="">UpDown</i>
control. Otherwise, we just forward to the parent control&#8217;s window procedure.</span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style="">LRESULT CALLBACK WindowProc(HWND hwnd, UINT
msg, WPARAM wParam, LPARAM lParam) {</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>JNIEnv
*env = TlsGetValue(tlsIndex);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>if
(env != NULL) {</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>/*
If an exception has already occurred,</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="">&nbsp;</span>* allow the stack to unwind so that the</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="">&nbsp;</span>* exception will be thrown in Java. */</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>if
((*env)-&gt;ExceptionOccurred(env)) return 0;</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>switch
(msg) {</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>case
WM_VSCROLL:</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>if
((wParam &amp; 0xFFFF) == SB_THUMBPOSITION) {</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>return
(LRESULT) ((*env)-&gt;CallStaticIntMethod(env, javaClass, mid, lParam));</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>break;</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>}</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>return
CallWindowProc(oldProc, hwnd, msg, wParam, lParam);<span style=""> </span></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style="">}</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style="">And finally, here is the code for <b style="">createControl</b>:</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style="">JNIEXPORT jint JNICALL
Java_spinner_Spinner_createControl</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;
</span>(JNIEnv *env, jclass that, jint hwndParent)</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style="">{</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>HWND
hwndText, hwndUpDown;</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>if
(tlsIndex == 0) {</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>tlsIndex
= TlsAlloc();</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>if
(tlsIndex == -1) return (jint) 0;</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>javaClass
= (*env)-&gt;NewGlobalRef(env, (jobject) that);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>mid
= (*env)-&gt;GetStaticMethodID(env, (jobject) that, "widgetSelected",
"(I)V");</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>oldProc
= (WNDPROC) GetWindowLong((HWND) hwndParent, GWL_WNDPROC);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>}</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>TlsSetValue(tlsIndex,
(LPVOID) env);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>hwndText
= CreateWindowEx(</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>WS_EX_CLIENTEDGE,</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>"EDIT",</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>NULL,</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>WS_CHILD
| WS_VISIBLE | WS_TABSTOP,</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>0,
0, 0, 0,</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>(HWND)
hwndParent,</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>0,</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>GetModuleHandle(NULL),</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>NULL);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>if
(hwndText == 0) return (jint) 0;</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>hwndUpDown
= CreateWindowEx(</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>0,</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>UPDOWN_CLASS,</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>NULL,</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>WS_CHILD
| WS_VISIBLE | UDS_AUTOBUDDY | UDS_SETBUDDYINT | UDS_ALIGNRIGHT | UDS_ARROWKEYS
| UDS_NOTHOUSANDS,</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>0,
0, 0, 0,</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>(HWND)
hwndParent,</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>0,</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>GetModuleHandle(NULL),</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>NULL);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>if
(hwndUpDown == 0) return (jint) 0;</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>SetWindowLong((HWND)
hwndParent, GWL_WNDPROC, (long) WindowProc);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>return
(jint) hwndUpDown;</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style="">}</span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style="">The set and get methods we need to implement
are much simpler than the <b style="">createControl</b>
and <b style="">WindowProc</b> methods. Here are <b style="">setPosition</b> and <b style="">getPosition</b>. They simply send the </span></span><span style=""><span style=""><span style="font-size: 11pt;">UDM_SETPOS</span> or </span></span><span style=""><span style=""><span style="font-size: 11pt;">UDM_GETPOS</span> message to
the <i style="">UpDown</i> handle. The remaining set and
get methods are similar, and they are listed in </span></span><a href="http://www.eclipse.org/articles/Article-Writing%20Your%20Own%20Widget/Writing%20Your%20Own%20Widget_files/AppendixC.htm"><span style=""><span style="">Appendix
C: Spinner for Windows</span></span><span style=""><span style=""></span></span></a><span style=""><span style="">. The only interesting
one is <b style="">setFont</b>, which sets the font
of the <i style="">Edit</i> control, which it gets by
sending </span></span><span style=""><span style=""><span style="font-size: 11pt;">UDM_GETBUDDY</span> to the <i style="">UpDown</i>
handle.</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style="">JNIEXPORT void JNICALL
Java_spinner_Spinner_setPosition</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;
</span>(JNIEnv *env, jclass that, jint hwnd, jint position)</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style="">{</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>SendMessage((HWND)
hwnd, UDM_SETPOS, 0, position);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style="">}</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style="">JNIEXPORT jint JNICALL Java_spinner_Spinner_getPosition</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;
</span>(JNIEnv *env, jclass that, jint hwnd)</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style="">{</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>return
(jint) SendMessage((HWND) hwnd, UDM_GETPOS, 0, 0) &amp; 0xFFFF;</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style="">}</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style="">The <b style="">resizeControl</b>
method positions the <i style="">Edit</i> control
(the buddy) and the <i style="">UpDown</i> (the arrow
buttons) using the specified coordinates and size. For the width of the arrow
buttons, we use the width of a typical vertical scrollbar.</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style="">JNIEXPORT void JNICALL
Java_spinner_Spinner_resizeControl</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;
</span>(JNIEnv *env, jclass that, jint hwndUpDown, jint x, jint y, jint width,
jint height)</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style="">{</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>HWND
hwndText = (HWND) SendMessage((HWND) hwndUpDown, UDM_GETBUDDY, 0, 0);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>UINT
flags = SWP_NOZORDER | SWP_DRAWFRAME | SWP_NOACTIVATE;</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>int
upDownWidth = GetSystemMetrics(SM_CXVSCROLL);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>SetWindowPos(hwndText,
(HWND) 0, x, y, width - upDownWidth + 2, height, flags);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>SetWindowPos((HWND)
hwndUpDown, (HWND) 0, x + width - upDownWidth, y, upDownWidth, height, flags);<span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style="">}</span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style="">The final method we need to write is <b style="">computeSize</b>. This is typically a
complex method, and our <b style="">computeSize</b>
is no exception. We construct a string of digits the same length as the maximum
value, and measure its height and width if drawn in the <i style="">Edit</i> control&#8217;s font. We make sure our control is no shorter than a
combo box, and we add in text margins, and the width of the arrow buttons. In
order to return the computed height and width values in the <b style="">result</b> array, we need to lock down the
array using the JNI function <b style="">GetIntArrayElements</b>
to protect it from moving as a result of garbage collection.</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style="">JNIEXPORT void JNICALL Java_spinner_Spinner_computeSize</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;
</span>(JNIEnv *env, jclass that, jint hwndUpDown, jintArray result) {</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>int
width, height;</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>TEXTMETRIC
tm;</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>RECT
rect;</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>int
comboHeight;</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>int
max, digits;</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>UINT
flags;</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>char
text[64];</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>HWND hwndText
= (HWND) SendMessage((HWND) hwndUpDown, UDM_GETBUDDY, 0, 0);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>HDC
hDC = GetDC(hwndText);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>HFONT
oldFont = 0;</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>HFONT
newFont = (HFONT) SendMessage(hwndText, WM_GETFONT, 0, 0);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>jint
*result1 = NULL;</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>result1
= (*env)-&gt;GetIntArrayElements(env, result, NULL);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>if
(newFont != 0) oldFont = SelectObject(hDC, newFont);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>GetTextMetrics(hDC,
&amp;tm);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>comboHeight
= GetSystemMetrics(SM_CYVSCROLL);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>height
= (comboHeight &gt; tm.tmHeight) ? comboHeight : tm.tmHeight;</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>max =
SendMessage((HWND) hwndUpDown, UDM_GETRANGE, 0, 0) &amp; 0xFFFF;</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>if
(max &gt; 0) {</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>digits
= 0;</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>while
(max &gt; 0) {</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>text[digits]
= '0';</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>max
/= 10;</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>digits++;</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>flags
= DT_CALCRECT | DT_EDITCONTROL | DT_NOPREFIX;</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>DrawText(hDC,
(LPCTSTR) text, digits, (LPRECT) &amp;rect, flags);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>width
= rect.right - rect.left + 3;</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>}
else {</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span><span style="">&nbsp;</span><span style="">&nbsp; </span>width
= 10;</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>}</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>if
(newFont != 0) SelectObject(hDC, oldFont);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>ReleaseDC(hwndText,
hDC);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>width
+= GetSystemMetrics(SM_CXVSCROLL);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>SendMessage(hwndText,
EM_GETRECT, 0, (LPARAM) &amp;rect);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>if (rect.top
== 0) rect.top = 1; // windows bug fix</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>width
+= (rect.left + 1) * 2;</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>height
+= (rect.top + 1) * 2;</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>result1
[0] = width;</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>result1
[1] = height;</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>(*env)-&gt;ReleaseIntArrayElements(env,
result, result1, 0);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style="">}</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style="">The full source listing for the Windows C
code and makefile are in </span></span><a href="http://www.eclipse.org/articles/Article-Writing%20Your%20Own%20Widget/Writing%20Your%20Own%20Widget_files/AppendixC.htm"><span style=""><span style="">Appendix
C: Spinner for Windows</span></span><span style=""><span style=""></span></span></a><span style=""><span style="">. A batch file sets
environment variables and calls make to create the DLL. Options for your
compiler and linker may differ, but you will have to link in the win32 libs:
comctl32.lib, user32.lib, and gdi32.lib.</span></span></p>

<span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;;"><br style="page-break-before: always;" clear="all">
</span>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><span style=""><span style=""><o:p></o:p></span></span></p>

<h3 style="margin-left: 25.5pt;"><span style=""><span style=""><a name="_Toc506634638">Motif Native Code</a></span></span></h3>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style="">Now we need to write &#8220;spinner.c&#8221; for Motif.
In this section, we will only point out the differences between the Motif
&#8220;spinner.c&#8221; and the Windows one. The full source listing for the Motif C code
and makefile are in </span></span><a href="http://www.eclipse.org/articles/Article-Writing%20Your%20Own%20Widget/Writing%20Your%20Own%20Widget_files/AppendixD.htm"><span style=""><span style="">Appendix
D: Spinner for Motif</span></span><span style=""><span style=""></span></span></a><span style=""><span style="">. A shell script sets
environment variables and calls make.</span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style="">The Motif equivalent to Thread Local Storage
is called Thread-Specific Data (TSD), and its functions are defined in <b style="">pthread.h</b>. You will need to include at
least the following files:</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style="">#include &lt;jni.h&gt;</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style="">#include &lt;Xm/XmAll.h&gt;</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style="">#include &lt;pthread.h&gt;</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style="">In order to store the <b style="">env</b> pointer in Thread-Specific Data, you first create a key:</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style="">static pthread_key_t envKey;</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>&#8230;</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>pthread_key_create(&amp;envKey,
NULL);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style="">and then you store into and retrieve from
TSD as follows:</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>pthread_setspecific(envKey,
env);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>JNIEnv
*env = (JNIEnv *) pthread_getspecific(envKey);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style="">As you compare the Windows and Motif
&#8220;spinner.c&#8221; listings, you will notice that the JNI portions of the code are
identical: method templates, the use of JNI functions like <b style="">GetIntArrayElements</b> and <b style="">ReleaseIntArrayElements</b>
for locking/releasing an array of integers, and <b style="">NewGlobalRef</b>, <b style="">GetStaticMethodID</b>,
and <b style="">CallStaticIntMethod</b> to call in
to Java.</span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style="">The platform code, however, is completely
different. On Motif, we create the native control using <b style="">XmCreateSimpleSpinBox</b>. The <i style="">Text</i>
widget is created automatically and stored in the <b style="">XmNtextField</b> resource of the <i style="">SimpleSpinBox</i>.
You can retrieve the <i style="">Text</i> (for
setting the font or computing the preferred size) using:</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>Arg
arg;</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>Widget
handleText;</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>XtSetArg(arg,
XmNtextField, &amp;handleText);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>XtGetValues((Widget)
handle, &amp;arg, 1);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style="">After creating the <i style="">SimpleSpinBox</i>, we have to &#8216;manage&#8217; it, and then we add an <b style="">XtCallbackProc</b> for the <b style="">valueChanged</b> callback:</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>XtManageChild(handleSpinBox);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><span style="">&nbsp; </span>XtAddCallback(handleSpinBox,
XmNvalueChangedCallback, (XtCallbackProc) Callback, NULL);</span></span></p>

<p class="Code" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style="">The <b style="">computeSize</b>
method is about as complex as the one for Windows, with height and width based
on the maximum number of digits, with margins and shadows added in.
Unfortunately, we had to guess a nice width for the arrow buttons, as this value
could not be retrieved from a <i style="">SimpleSpinBox</i>.<br style="page-break-before: always;" clear="all">
</span></span></p>

<h3 style="margin-left: 25.5pt;"><span style=""><span style=""><a name="_Toc506634639">Mixing Native and
Java Widgets</a></span></span></h3>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style="">Occasionally it is necessary to implement a
widget using a native widget on one platform, and emulating the widget behavior
with Java code on another platform. SWT does this for several widgets; for
example, <i style="">Tree</i> is native on Windows,
and emulated on Motif. All of the code to implement <i style="">Tree</i> on Motif is shipped in the SWT jar for Motif. On Windows, the
API for <i style="">Tree</i> is shipped in the
Windows SWT jar and the interface to the native control is shipped in the
Windows SWT shared library (SWT.DLL).</span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style="">When emulating a widget on one platform and
wrapping a native or third party widget on another, it is important to subclass
at the same point in the <i style="">Widget</i>
hierarchy on both platforms (i.e. <i style="">Composite</i>
or <i style="">Canvas</i>). It is also important to
make certain that the public API is identical for both widgets. This makes it
possible for applications to run on any platform without recompiling.</span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style=""><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style="">Looking at the <i style="">Spinner</i> example in the previous section, suppose we now want to
have a <i style="">Spinner</i> on a third platform
that does not have a native <i style="">SpinBox</i>
or <i style="">UpDown</i> control. Since we
subclassed<i style=""> Composite</i> on Windows and
Motif, we again subclass <i style="">Composite</i> on
the new platform. Then we create three children: a <i style="">Text</i> and two arrow <i style="">Buttons</i>.
Then we fill in the API and write our widget as described earlier in the <span style="">Compound Widget Example<!--[if gte mso 9]><xml>
 <w:data>08D0C9EA79F9BACE118C8200AA004BA90B02000000080000000E0000005F005200650066003500300036003100390030003200300031000000</w:data>
</xml><![endif]--></span> section. The full source code listing for this 100%
Java <i style="">Spinner</i> is in </span></span><a href="http://www.eclipse.org/articles/Article-Writing%20Your%20Own%20Widget/Writing%20Your%20Own%20Widget_files/AppendixE.htm"><span style=""><span style="">Appendix
E: Spinner for Any Platform</span></span><span style=""><span style=""></span></span></a><span style=""><span style="">.</span></span></p>

<b style=""><span style="font-size: 14pt; font-family: &quot;Times New Roman&quot;;"><br style="page-break-before: always;" clear="all">
</span></b>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style=""><b style=""><span style="font-size: 18pt;">Summary</span></b></span></span><b style=""><span style="font-size: 18pt;"><o:p></o:p></span></b></p>

<p class="MsoNormal" style="margin-left: 25.5pt;">SWT provides several different
ways to implement new widgets. The simplest method, and the one you will
typically use, is to subclass <i style="">Canvas</i>
or <i style="">Composite</i> and add listeners and
methods to get the job done.</p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;">In certain cases the
specification for your new widget will so closely resemble a single existing
SWT widget that you will want to use that widget in your implementation. The recommended
way to do this is to wrap the SWT widget in a subclass of <i style="">Composite</i>, and implement a carefully determined subset of the
wrapped widget&#8217;s methods by forwarding to the wrapped widget.</p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;">Occasionally, you may need to
wrap a platform or third party widget by writing a platform-specific shared
library that makes calls to this widget. You can then subclass <i style="">Composite</i> and provide a Java native
interface to your library code.</p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></p>

<p class="MsoNormal" style="margin-left: 25.5pt;">Finally, in very special and rare
circumstances, you can subclass an existing SWT widget, but this is not
recommended.</p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style="font-size: 9pt; font-family: &quot;Courier New&quot;;"><!--[if !supportEmptyParas]-->&nbsp;<!--[endif]--><o:p></o:p></span></p>

<h4 style="margin-left: 25.5pt;"><b>Example Code<o:p></o:p></b></h4>

<p class="MsoNormal" style="margin-left: 25.5pt;"><a name="_Ref498278978"></a><a name="_Toc506634640"><span style=""></span></a><a href="http://www.eclipse.org/articles/Article-Writing%20Your%20Own%20Widget/Writing%20Your%20Own%20Widget_files/AppendixA.htm"><span style=""><span style="">Appendix
A: TableTree and TableTreeItem</span></span><span style=""></span><span style=""></span><span style=""><span style=""><span style=""></span></span></span><span style=""><span style=""><span style=""></span></span></span></a><!--[if !supportNestedAnchors]--><a name="_Toc506634643"></a><a name="_Ref506203309"></a><a name="_Ref506196466"></a><!--[endif]--><span style=""><span style=""><span style=""></span></span></span></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><span style=""><span style=""><span style=""></span></span></span><a href="http://www.eclipse.org/articles/Article-Writing%20Your%20Own%20Widget/Writing%20Your%20Own%20Widget_files/AppendixB.htm"><span style=""><span style=""><span style="">Appendix B: Spinner</span></span></span><span style="">Test and Spinner</span><span style=""></span></a></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><a name="_Ref506009163"></a><a name="_Toc506634646"><span style=""></span></a><a href="http://www.eclipse.org/articles/Article-Writing%20Your%20Own%20Widget/Writing%20Your%20Own%20Widget_files/AppendixC.htm"><span style=""><span style="">Appendix
C: Spinner for Windows</span></span><span style=""></span><span style=""></span><span style=""><span style=""></span></span><span style=""><span style=""></span></span></a><!--[if !supportNestedAnchors]--><a name="_Toc506634650"></a><a name="_Ref506009181"></a><!--[endif]--><span style=""><span style=""></span></span></p>

<p class="MsoHeader" style="margin-left: 25.5pt;"><span style=""><span style=""></span></span><a href="http://www.eclipse.org/articles/Article-Writing%20Your%20Own%20Widget/Writing%20Your%20Own%20Widget_files/AppendixD.htm"><span style=""><span style="">Appendix
D: Spinner for Motif</span></span><span style=""></span><span style=""></span></a></p>

<p class="MsoNormal" style="margin-left: 25.5pt;"><a name="_Ref506190577"></a><a name="_Toc506634654"><span style=""></span></a><a href="http://www.eclipse.org/articles/Article-Writing%20Your%20Own%20Widget/Writing%20Your%20Own%20Widget_files/AppendixE.htm"><span style=""><span style="">Appendix
E: Spinner for Any Platform</span></span><span style=""></span><span style=""></span></a><span style="font-size: 9pt; font-family: &quot;Courier New&quot;;"><o:p></o:p></span></p>

</div>
<p><small>Java and all Java-based trademarks and logos are trademarks or registered
trademarks of Sun Microsystems, Inc. in the United States, other countries, or
both.</small></p>
<p><small>Microsoft, Windows, Windows NT, and the Windows logo are
trademarks of Microsoft Corporation in the United States, other
countries, or both.</small></p>
</body></html>